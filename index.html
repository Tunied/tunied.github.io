<!DOCTYPE html>




<html class="theme-next gemini" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="HaFr6IFRWpWkG_Eyt4dUUQlgTyTE85bMpbJKQQgp0Rw" />














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="ç‹¬ç«‹æ¸¸æˆå¼€å‘è€…">
<meta property="og:type" content="website">
<meta property="og:title" content="éš”å£è€ç‹">
<meta property="og:url" content="http://www.oldking.wang/index.html">
<meta property="og:site_name" content="éš”å£è€ç‹">
<meta property="og:description" content="ç‹¬ç«‹æ¸¸æˆå¼€å‘è€…">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="éš”å£è€ç‹">
<meta name="twitter:description" content="ç‹¬ç«‹æ¸¸æˆå¼€å‘è€…">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.oldking.wang/"/>





  <title>éš”å£è€ç‹ - ç‹¬ç«‹æ¸¸æˆå¼€å‘è€…</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-111727312-1', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">éš”å£è€ç‹</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">ç‹¬ç«‹æ¸¸æˆå¼€å‘è€…</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-unity">
          <a href="/categories/Unity" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-diamond"></i> <br />
            
            Unity
          </a>
        </li>
      
        
        <li class="menu-item menu-item-ç¼–ç¨‹">
          <a href="/categories/ç¼–ç¨‹" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-graduation-cap"></i> <br />
            
            ç¼–ç¨‹
          </a>
        </li>
      
        
        <li class="menu-item menu-item-å…¶ä»–">
          <a href="/categories/å…¶ä»–" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-beer"></i> <br />
            
            å…¶ä»–
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/cb07f070-ae97-11e8-9414-077be260bdcd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="éš”å£è€ç‹">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="éš”å£è€ç‹">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/cb07f070-ae97-11e8-9414-077be260bdcd/" itemprop="url">Luaä»å…¥é—¨åˆ°å…¥äº†é—¨(6) OOPæ·±å…¥åˆ†æä¹‹Oldkingç‰ˆ</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-09-02T18:00:06+08:00">
                2018-09-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ç¼–ç¨‹/" itemprop="url" rel="index">
                    <span itemprop="name">ç¼–ç¨‹</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="æ‹¿èµ°ç›´æ¥ç”¨ç‰ˆ"><a href="#æ‹¿èµ°ç›´æ¥ç”¨ç‰ˆ" class="headerlink" title="æ‹¿èµ°ç›´æ¥ç”¨ç‰ˆ"></a>æ‹¿èµ°ç›´æ¥ç”¨ç‰ˆ</h2><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">class</span><span class="params">(super)</span></span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">local</span> newClass = &#123;&#125;</span><br><span class="line">    newClass.super = super</span><br><span class="line">    newClass.<span class="built_in">__index</span> = newClass</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">newClass.new</span><span class="params">(...)</span></span></span><br><span class="line">        <span class="keyword">local</span> o = &#123;&#125;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">            <span class="keyword">local</span> <span class="built_in">create</span></span><br><span class="line">            <span class="built_in">create</span> = <span class="function"><span class="keyword">function</span><span class="params">(_class, ...)</span></span></span><br><span class="line">                <span class="keyword">if</span> _class.super <span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">create</span>(_class.super, ...)</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">if</span> _class.ctor <span class="keyword">then</span></span><br><span class="line">                    _class.ctor(o, ...)</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            </span><br><span class="line">            <span class="built_in">create</span>(newClass, ...)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">setmetatable</span>(o, newClass)</span><br><span class="line">        <span class="keyword">return</span> o</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> super <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">setmetatable</span>(newClass, &#123;<span class="built_in">__index</span> =</span><br><span class="line">            <span class="function"><span class="keyword">function</span> <span class="params">(t, k)</span></span></span><br><span class="line">                <span class="keyword">local</span> v = super[k];</span><br><span class="line">                newClass[k] = v</span><br><span class="line">                <span class="keyword">return</span> v</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> newClass</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>å°†å¦‚ä¸Šä»£ç å°è£…ä¸º<code>ClassE.lua</code>,ç„¶ååˆ›å»ºå¦‚ä¸‹luaæ–‡ä»¶</p>
<p><code>Animal.lua</code></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">AnimalClass = class()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AnimalClass:ctor</span><span class="params">(_name)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"call animal ctor name is: "</span>.._name)</span><br><span class="line">    self.mName = _name</span><br><span class="line">    self.mFood = <span class="string">"normal food"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AnimalClass:SayHI</span><span class="params">(_msg)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"Animal %s say hi with msg : %s"</span>, self.mName, _msg))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AnimalClass:Eat</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"Animal %s eat with food : %s"</span>, self.mName, self:GetEatFood()))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AnimalClass:GetEatFood</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> self.mFood</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p><code>Cat.lua</code></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CatClass = class(AnimalClass)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CatClass:ctor</span><span class="params">(_name, _color)</span></span></span><br><span class="line">    <span class="comment">--CatClass.super.ctor(self, _name)</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"call cat ctor name is: %s color is %s"</span>, _name, _color))</span><br><span class="line">    self.mColor = _color</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CatClass:SayHI</span><span class="params">(_msg)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[Override] CatClass start"</span>)</span><br><span class="line">    CatClass.super.SayHI(self, _msg)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[Override] CatClass end"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CatClass:GetEatFood</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Fish"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p><code>main.lua</code></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">"ClassE"</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"Animal"</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"Cat"</span>)</span><br><span class="line"></span><br><span class="line">a1 = AnimalClass.new(<span class="string">"A1"</span>)</span><br><span class="line">a1:SayHI(<span class="string">"oh~"</span>)</span><br><span class="line">a1:Eat()</span><br><span class="line"></span><br><span class="line">c1 = CatClass.new(<span class="string">"C1"</span>,<span class="string">"Red"</span>)</span><br><span class="line">c1:SayHI(<span class="string">"oh~"</span>)</span><br><span class="line">c1:Eat()</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœ</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">call animal ctor name is: A1</span><br><span class="line"></span><br><span class="line">Animal A1 say hi with msg : oh~</span><br><span class="line">Animal A1 eat with food : normal food</span><br><span class="line"></span><br><span class="line">call animal ctor name is: C1</span><br><span class="line">call cat ctor name is: C1 color is Red</span><br><span class="line"></span><br><span class="line">[Override] CatClass start</span><br><span class="line">Animal C1 say hi with msg : oh~</span><br><span class="line">[Override] CatClass <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">Animal C1 eat with food : Fish</span><br></pre></td></tr></table></figure>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>è¿™ä¸ªä»£ç å…¶å®å°±æ˜¯<a href="http://oldking.wang/91a7d430-ae97-11e8-8886-2901af87d97e/" target="_blank" rel="noopener">Quickç‰ˆ</a> å’Œ <a href="http://oldking.wang/905e8b50-ae97-11e8-980c-c39a9b9cf992/" target="_blank" rel="noopener">é£ç¥ç‰ˆ</a> çš„ç»“åˆä½“. æœ‰Quickç‰ˆå®ç°çš„ç®€çº¦,åŒæ—¶åˆæœ‰é£ç¥ç‰ˆ<code>Write On Use</code>ç‰¹æ€§. å¹¶ä¸”è¿˜æ”¯æŒè°ƒç”¨çˆ¶ç±»åŒåå‡½æ•°</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CatClass.super.SayHI(self, _msg)</span><br></pre></td></tr></table></figure>
<p>å¥½äº†,è‡ªå¤¸ç»“æŸ. ç”¨ä¸€å¥å¹¿å‘Šç»“å°¾å¥½äº†</p>
<blockquote>
<p>æˆ‘ä»¬ä¸ç”Ÿäº§æ°´ æˆ‘ä»¬åªæ˜¯å¤§è‡ªç„¶çš„æ¬è¿å·¥ ğŸ˜‚ğŸ˜‚ğŸ˜‚</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/905e8b50-ae97-11e8-980c-c39a9b9cf992/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="éš”å£è€ç‹">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="éš”å£è€ç‹">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/905e8b50-ae97-11e8-980c-c39a9b9cf992/" itemprop="url">Luaä»å…¥é—¨åˆ°å…¥äº†é—¨(5) OOPæ·±å…¥åˆ†æä¹‹é£äº‘ç‰ˆ</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-09-02T18:00:05+08:00">
                2018-09-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ç¼–ç¨‹/" itemprop="url" rel="index">
                    <span itemprop="name">ç¼–ç¨‹</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="åŸå§‹å®ç°"><a href="#åŸå§‹å®ç°" class="headerlink" title="åŸå§‹å®ç°"></a>åŸå§‹å®ç°</h2><p><a href="https://blog.codingnow.com/cloud/LuaOO" target="_blank" rel="noopener">æºç è¿æ¥</a><br><a href="https://blog.codingnow.com/2006/06/oo_lua.html" target="_blank" rel="noopener">åŸæ–‡</a></p>
<p>å…·ä½“ä»£ç :</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> _class=&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">class</span><span class="params">(super)</span></span></span><br><span class="line">	<span class="keyword">local</span> class_type=&#123;&#125;</span><br><span class="line">	class_type.ctor=<span class="literal">false</span></span><br><span class="line">	class_type.super=super</span><br><span class="line">	class_type.new=<span class="function"><span class="keyword">function</span><span class="params">(...)</span></span> </span><br><span class="line">			<span class="keyword">local</span> obj=&#123;&#125;</span><br><span class="line">			<span class="keyword">do</span></span><br><span class="line">				<span class="keyword">local</span> <span class="built_in">create</span></span><br><span class="line">				<span class="built_in">create</span> = <span class="function"><span class="keyword">function</span><span class="params">(c,...)</span></span></span><br><span class="line">					<span class="keyword">if</span> c.super <span class="keyword">then</span></span><br><span class="line">						<span class="built_in">create</span>(c.super,...)</span><br><span class="line">					<span class="keyword">end</span></span><br><span class="line">					<span class="keyword">if</span> c.ctor <span class="keyword">then</span></span><br><span class="line">						c.ctor(obj,...)</span><br><span class="line">					<span class="keyword">end</span></span><br><span class="line">				<span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line">				<span class="built_in">create</span>(class_type,...)</span><br><span class="line">			<span class="keyword">end</span></span><br><span class="line">			<span class="built_in">setmetatable</span>(obj,&#123; <span class="built_in">__index</span>=_class[class_type] &#125;)</span><br><span class="line">			<span class="keyword">return</span> obj</span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">	<span class="keyword">local</span> vtbl=&#123;&#125;</span><br><span class="line">	_class[class_type]=vtbl</span><br><span class="line"> </span><br><span class="line">	<span class="built_in">setmetatable</span>(class_type,&#123;<span class="built_in">__newindex</span>=</span><br><span class="line">		<span class="function"><span class="keyword">function</span><span class="params">(t,k,v)</span></span></span><br><span class="line">			vtbl[k]=v</span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">	&#125;)</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">if</span> super <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">setmetatable</span>(vtbl,&#123;<span class="built_in">__index</span>=</span><br><span class="line">			<span class="function"><span class="keyword">function</span><span class="params">(t,k)</span></span></span><br><span class="line">				<span class="keyword">local</span> ret=_class[super][k]</span><br><span class="line">				vtbl[k]=ret</span><br><span class="line">				<span class="keyword">return</span> ret</span><br><span class="line">			<span class="keyword">end</span></span><br><span class="line">		&#125;)</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line">	<span class="keyword">return</span> class_type</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>å’Œ<a href="http://oldking.wang/91a7d430-ae97-11e8-8886-2901af87d97e/" target="_blank" rel="noopener">QuickXçš„Demo</a>åŸºæœ¬ç›¸åŒ</p>
<p>å°†å¦‚ä¸Šå‡½æ•°ä¿å­˜ä¸º<code>ClassF.lua</code></p>
<p>å†åˆ›å»ºå¦‚ä¸‹æ–‡ä»¶</p>
<p><code>AnimalClass.lua</code></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">AnimalClass = class()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AnimalClass:ctor</span><span class="params">(_name)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"call animal ctor name is: "</span>.._name)</span><br><span class="line">    self.mName = _name</span><br><span class="line">    self.mFood = <span class="string">"normal food"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AnimalClass:SayHI</span><span class="params">(_msg)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"Animal %s say hi with msg : %s"</span>, self.mName, _msg))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AnimalClass:Eat</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"Animal %s eat with food : %s"</span>, self.mName, self:GetEatFood()))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AnimalClass:GetEatFood</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> self.mFood</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p><code>Cat.lua</code></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CatClass = class(AnimalClass)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CatClass:ctor</span><span class="params">(_name, _color)</span></span></span><br><span class="line">    <span class="comment">--CatClass.super.ctor(self, _name)</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"call cat ctor name is: %s color is %s"</span>, _name, _color))</span><br><span class="line">    self.mColor = _color</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CatClass:SayHI</span><span class="params">(_msg)</span></span></span><br><span class="line">    <span class="comment">--CatClass.super.SayHI(self, _msg)</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[Override] CatClass called"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CatClass:GetEatFood</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Fish"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>å…¥å£æ–‡ä»¶<code>main.lua</code></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">"ClassF"</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"Animal"</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"Cat"</span>)</span><br><span class="line"></span><br><span class="line">a1 = AnimalClass.new(<span class="string">"A1"</span>)</span><br><span class="line">a1:SayHI(<span class="string">"oh~"</span>)</span><br><span class="line">a1:Eat()</span><br><span class="line"></span><br><span class="line">c1 = CatClass.new(<span class="string">"C1"</span>,<span class="string">"Red"</span>)</span><br><span class="line">c1:SayHI(<span class="string">"oh~"</span>)</span><br><span class="line">c1:Eat()</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœä¸º:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">call animal ctor name is: A1</span><br><span class="line"></span><br><span class="line">Animal A1 say hi with msg : oh~</span><br><span class="line">Animal A1 eat with food : normal food</span><br><span class="line"></span><br><span class="line">call animal ctor name is: C1</span><br><span class="line">call cat ctor name is: C1 color is Red</span><br><span class="line"></span><br><span class="line">[Override] CatClass called</span><br><span class="line">Animal C1 eat with food : Fish</span><br></pre></td></tr></table></figure>
<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>Demoä»£ç åŸºæœ¬ä¸Šå’ŒQuickXçš„é‚£ä¸ªç›¸åŒ,åªæ˜¯<code>class</code>å®šä¹‰åˆæ— éœ€å†ä¼ å…¥<code>className</code>äº†,åŒæ—¶<code>Cat.lua</code>ä¸­æ³¨é‡Šæ‰äº†ä¸¤è¡Œ</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--CatClass.super.ctor(self, _name)</span></span><br><span class="line"><span class="comment">--CatClass.super.SayHI(self, _msg)</span></span><br></pre></td></tr></table></figure>
<p><code>ctor</code>é‚£ä¸ªä¸ºæ— éœ€æ‰‹åŠ¨è°ƒç”¨,<code>SayHI</code>è¿™ä¸ªä¸ºæ— æ³•å®ç°. </p>
<p>ä¸‹é¢æˆ‘å°±æ¥åˆ†æä¸‹åŸå› </p>
<h3 id="äº‹å…ˆäº†è§£"><a href="#äº‹å…ˆäº†è§£" class="headerlink" title="äº‹å…ˆäº†è§£"></a>äº‹å…ˆäº†è§£</h3><blockquote>
<p> å¦‚æœä½ å¯¹ä¸ºä½•èƒ½ç­‰æ•ˆè½¬æ¢åŠ2Bæƒ…æ™¯æ³•æœ‰ç–‘é—®,è¯·çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« : <a href="http://oldking.wang/fe8c5fe0-ae96-11e8-abfb-e54ee4891837/" target="_blank" rel="noopener">Luaä»å…¥é—¨åˆ°å…¥äº†é—¨(2) åŸºç¡€éš¾ç‚¹æ¦‚è¿°</a></p>
</blockquote>
<h3 id="ç­‰æ•ˆè½¬æ¢"><a href="#ç­‰æ•ˆè½¬æ¢" class="headerlink" title="ç­‰æ•ˆè½¬æ¢"></a>ç­‰æ•ˆè½¬æ¢</h3><p>é£ç¥çš„ä»£ç åˆçœ‹æ˜¯å¾ˆæ‡µåœˆçš„,è€ä¸€ä»£è‰ºæœ¯å®¶,åœ¨ä»£ç ä¸­æ²‰æµ¸äº†å¤šå¹´ éšä¾¿æŠ–ä¸¤ç¬” æ‰€è¡¨è¾¾å‡ºçš„æ„å¢ƒ éƒ½éœ€è¦æˆ‘ç­‰å‡¡å¤«ä¿—å­ èŠ±è®¸ä¹… å‚æ‚Ÿå‚æ‚Ÿçš„ğŸ˜‚ğŸ˜‚ğŸ˜‚</p>
<p>ä¸ºäº†æ–¹ä¾¿æˆ‘ç­‰ä¿—äººç†è§£,æˆ‘å°±ç ´åä¸€ä¸‹ç¾æ„ŸæŠŠä»£ç ç»™æ”¹Lowä¸€ä¸‹,æ–¹ä¾¿ç ”è¯»ä¸€ä¸‹ğŸ˜‘</p>
<p>é€šä¿—ç‰ˆä»£ç å¦‚ä¸‹:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">local</span> mAllClassMetatableCoreCache = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">class</span><span class="params">(superFromArg)</span></span></span><br><span class="line">    <span class="keyword">local</span> NewClass = &#123;&#125;</span><br><span class="line">    <span class="keyword">local</span> NewClassMetatableCore = &#123;&#125;</span><br><span class="line">    mAllClassMetatableCoreCache[NewClass] = NewClassMetatableCore</span><br><span class="line">    </span><br><span class="line">    NewClass.ctor = <span class="literal">false</span></span><br><span class="line">    NewClass.super = superFromArg</span><br><span class="line">    NewClass.new = <span class="function"><span class="keyword">function</span><span class="params">(...)</span></span></span><br><span class="line">        <span class="keyword">local</span> _newInstance = &#123;&#125;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">            <span class="keyword">local</span> <span class="built_in">create</span></span><br><span class="line">            <span class="built_in">create</span> = <span class="function"><span class="keyword">function</span><span class="params">(_class, ...)</span></span></span><br><span class="line">                <span class="keyword">if</span> _class.super <span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">create</span>(_class.super, ...)</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">if</span> _class.ctor <span class="keyword">then</span></span><br><span class="line">                    _class.ctor(_newInstance, ...)</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            </span><br><span class="line">            <span class="built_in">create</span>(NewClass, ...)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="built_in">setmetatable</span>(_newInstance, &#123;<span class="built_in">__index</span> = NewClassMetatableCore&#125;)</span><br><span class="line">        <span class="keyword">return</span> _newInstance</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">setmetatable</span>(NewClass, &#123;<span class="built_in">__newindex</span> =</span><br><span class="line">        <span class="function"><span class="keyword">function</span><span class="params">(t, k, v)</span></span></span><br><span class="line">            NewClassMetatableCore[k] = v</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> superFromArg <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">setmetatable</span>(NewClassMetatableCore, &#123;<span class="built_in">__index</span> =</span><br><span class="line">            <span class="function"><span class="keyword">function</span><span class="params">(t, k)</span></span></span><br><span class="line">                <span class="keyword">local</span> ret = mAllClassMetatableCoreCache[superFromArg][k]</span><br><span class="line">                NewClassMetatableCore[k] = ret</span><br><span class="line">                <span class="keyword">return</span> ret</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> NewClass</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="æ‹†è§£åˆ†æ"><a href="#æ‹†è§£åˆ†æ" class="headerlink" title="æ‹†è§£åˆ†æ"></a>æ‹†è§£åˆ†æ</h3><h4 id="newå‡½æ•°"><a href="#newå‡½æ•°" class="headerlink" title="newå‡½æ•°"></a>newå‡½æ•°</h4><p>è¿˜æ˜¯å’Œä¹‹å‰ä¸€æ · å…ˆæ¥åˆ†æä¸€ä¸‹çœ‹ä¼¼ç®€å•çš„newå‡½æ•°</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">NewClass.new = <span class="function"><span class="keyword">function</span><span class="params">(...)</span></span></span><br><span class="line">    <span class="keyword">local</span> _newInstance = &#123;&#125;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> <span class="built_in">create</span></span><br><span class="line">        <span class="built_in">create</span> = <span class="function"><span class="keyword">function</span><span class="params">(_class, ...)</span></span></span><br><span class="line">            <span class="keyword">if</span> _class.super <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">create</span>(_class.super, ...)</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">if</span> _class.ctor <span class="keyword">then</span></span><br><span class="line">                _class.ctor(_newInstance, ...)</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">create</span>(NewClass, ...)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="built_in">setmetatable</span>(_newInstance, &#123;<span class="built_in">__index</span> = NewClassMetatableCore&#125;)</span><br><span class="line">    <span class="keyword">return</span> _newInstance</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>å‰åŠéƒ¨åˆ†åº”è¯¥å¾ˆå¥½ç†è§£,å°±æ˜¯ä¸€ç›´é€’å½’åˆ°æ ¹Classç„¶åé€å±‚è°ƒç”¨ctor. æœ‰é—®é¢˜çš„å…¶å®æ˜¯ çœ‹ä¼¼å¹³å¸¸çš„</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setmetatable</span>(_newInstance, &#123;<span class="built_in">__index</span> = NewClassMetatableCore&#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™å·²ç»æ˜¯è¢«æˆ‘ç¿»è¯‘è¿‡ä¸€æ¬¡çš„äº†,åŸå§‹çš„ä»£ç æ˜¯</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setmetatable</span>(obj,&#123; <span class="built_in">__index</span>=_class[class_type] &#125;)</span><br></pre></td></tr></table></figure>
<p>ç„¶å<code>_class</code>å’Œ<code>class_type</code>çš„å®šä¹‰å‡åœ¨å‰é¢.</p>
<p>è¿˜æ˜¯å›åˆ°æˆ‘çš„lowç‰ˆä»£ç å§,</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ <code>setmetatable(x, {__index = y})</code>è¿™ç§å†™æ³•æˆ‘<a href="http://oldking.wang/fe8c5fe0-ae96-11e8-abfb-e54ee4891837/" target="_blank" rel="noopener">ä¹‹å‰</a>æœ‰æè¿‡, å°±æ˜¯çœŸå¤§å“¥å‡å¤§å“¥çš„é—®é¢˜</p>
<p>åŒæ—¶,æ­¤å¤„ç›¸æ¯”äº<code>Quick</code>ä»£ç ä¸­</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newClass.new</span><span class="params">(...)</span></span></span><br><span class="line">        <span class="keyword">local</span> instance = &#123;&#125;</span><br><span class="line">        <span class="built_in">setmetatable</span>(instance, newClass)</span><br><span class="line">        instance.class = newClass</span><br><span class="line">        instance:ctor(...)</span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>ç›´æ¥æŠŠ<code>instance</code>å’Œ<code>class</code>è¿›è¡Œç»‘å®š, é£ç¥æ˜¯å§<code>instance</code>å’Œ<code>NewClassMetatableCore</code>è¿›è¡Œäº†ç»‘å®š,(æˆ‘ç‰¹æ„èµ·äº†ä¸€ä¸ªæ¯”è¾ƒè¯¡å¼‚çš„åå­—,æ–¹ä¾¿ç†è§£). </p>
<p>å› ä¸ºè¿™éƒ¨åˆ†æ²¡æ³•å•ç‹¬è¯´,æ‰€ä»¥æš‚æ—¶è®©æˆ‘ä»¬å…ˆè·³è¿‡<code>new</code>å‡½æ•°åˆ†æ,çœ‹ä¸€ä¸‹<code>newClass</code>çš„å®ç°</p>
<h4 id="class-å®šä¹‰éƒ¨åˆ†"><a href="#class-å®šä¹‰éƒ¨åˆ†" class="headerlink" title="class å®šä¹‰éƒ¨åˆ†"></a>class å®šä¹‰éƒ¨åˆ†</h4><p>è¿™éƒ¨åˆ†åˆ†æˆä¸¤å—,å°±æ˜¯æœ‰<code>super</code>å’Œæ²¡<code>super</code>çš„.</p>
<h5 id="åŸºç±»Class"><a href="#åŸºç±»Class" class="headerlink" title="åŸºç±»Class"></a>åŸºç±»Class</h5><p>å…ˆè®©æˆ‘ä»¬æ¥çœ‹æ²¡æœ‰Superçš„,å°±æ˜¯ä¾‹å­ä¸­çš„<code>AnimalClass</code>.</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setmetatable</span>(NewClass, &#123;<span class="built_in">__newindex</span> =</span><br><span class="line">       <span class="function"><span class="keyword">function</span><span class="params">(t, k, v)</span></span></span><br><span class="line">           NewClassMetatableCore[k] = v</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">   &#125;)</span><br></pre></td></tr></table></figure>
<p>å¸¦å…¥ä¾‹å­,è¿™é‡Œé¢çš„<code>NewClass</code>å°±æ˜¯å¯¹åº”çš„<code>AnimalClass</code>,è€Œè¿™æ®µä»£ç çš„æ„æ€å‘¢ å°±æ˜¯è¯´ åœ¨å¾€<code>AnimalClass</code>è¿™å¼ Tableä¸Šæ·»åŠ ä»»ä½•key,vlaueæ—¶å€™å‘¢ éƒ½é€šé€šç»™æˆ‘æ·»åŠ åˆ°<code>NewClassMetatableCore</code>ä¸Šæ¥.</p>
<p>æ‰€ä»¥å½“åé¢æˆ‘ä»¬å»å†™<code>Animal.lua</code>æ–‡ä»¶</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AnimalClass:SayHI</span><span class="params">(_msg)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"Animal %s say hi with msg : %s"</span>, self.mName, _msg))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AnimalClass:Eat</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"Animal %s eat with food : %s"</span>, self.mName, self:GetEatFood()))</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>è¿™äº›å‡½æ•° å…¶å®æ²¡æœ‰ä»»ä½•ä¸€æ¡æ˜¯å†™åœ¨<code>AnimalClass</code>è¿™å¼ tableä¸Šçš„</p>
<h5 id="å­ç±»"><a href="#å­ç±»" class="headerlink" title="å­ç±»"></a>å­ç±»</h5><p>é‚£<code>AnimalClass</code>æ€ä¹ˆç†è§£çš„, æˆ‘æ˜¯æŠŠè¿™ä¸ªå½“åš â€œé’¥åŒ™â€ æ¥ç†è§£çš„,å¹¶ä¸”è¿˜ä¸æ˜¯å¯¹è‡ªå·±,è€Œæ˜¯ç›¸å¯¹äº<code>CatClass</code></p>
<p>æ¥çœ‹æœ‰<code>super</code>éƒ¨åˆ†çš„ä»£ç å®ç°</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> superFromArg <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">setmetatable</span>(NewClassMetatableCore, &#123;<span class="built_in">__index</span> =</span><br><span class="line">        <span class="function"><span class="keyword">function</span><span class="params">(t, k)</span></span></span><br><span class="line">            <span class="keyword">local</span> ret = mAllClassMetatableCoreCache[superFromArg][k]</span><br><span class="line">            NewClassMetatableCore[k] = ret</span><br><span class="line">            <span class="keyword">return</span> ret</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    &#125;)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä»£ç çš„æ„æ€å‘¢,å°±æ˜¯ç»™ <code>NewClassMetatableCore</code> ç»‘å®šäº† ä¸€ä¸ªå¤§å“¥,è¿™ä¸ªå¤§å“¥å‘¢è¿˜å’Œä¹‹å‰çš„ä¾‹å­ä¸åŒ,ä¸æ˜¯ä¸€ä¸ªä¸å¹²äº‹å„¿çš„å¤§å“¥ è€Œæ˜¯ä¸€æ®µæ–¹æ³•.</p>
<p>è¿™æ®µä»£ç  ç›´æ¥çœ‹æœ‰ç‚¹ç»•, è®©æˆ‘ä»¬ç›´æ¥å¸¦å…¥ä¾‹å­æ¥çœ‹ è¿™æ®µæ—¶æ€ä¹ˆå·¥ä½œçš„å§</p>
<p>é¦–å…ˆæ‹¿å‡ºä¹‹å‰ä¾‹å­çš„ä¸­å°c(c1)</p>
<p>c1æ˜¯ä¸€ä¸ªå¯¹è±¡äº† c1çš„çœŸå¤§å“¥å‘¢ æ˜¯ <code>setmetatable(_newInstance, {__index = NewClassMetatableCore})</code>ä¸­çš„<code>{__index = NewClassMetatableCore}</code></p>
<p>æŠŠCatå¸¦å…¥å°±æ˜¯ <code>catçœŸå¤§å“¥={__index = CatClassMetatableCore}</code> , <code>catå‡å¤§å“¥= CatClassMetatableCore</code></p>
<p>é¦–å…ˆæˆ‘ä»¬çŸ¥é“,å½“å†™<code>Cat.lua</code>æ—¶å€™</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CatClass:SayHI</span><span class="params">(_msg)</span></span></span><br><span class="line">    <span class="comment">--CatClass.super.SayHI(self, _msg)</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[Override] CatClass called"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CatClass:GetEatFood</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Fish"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æŠŠ<code>SayHI</code>å’Œ<code>GetEatFood</code>ä¸¤ä¸ªæ–¹æ³•å†™åˆ° è¿™ä¸ª<code>catå‡å¤§å“¥</code>èº«ä¸Šäº†. ä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰å†™<code>Eat</code>è¿™ä¸ªæ–¹æ³•. æ‰€ä»¥å½“è°ƒç”¨</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c1:Eat()</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆc1å…ˆæ‡µåœˆ ä¸çŸ¥é“Eatæ˜¯å•¥ ç„¶åä»–å°±å»é—®ä»–çš„ <code>catçœŸå¤§å“¥</code>,çœŸå¤§å“¥æ‰“æ‰‹ä¸€æŒ‡ å°±è®© å°c å»ä»–çš„<code>catå‡å¤§å“¥</code>èº«ä¸Šæ‰¾å».</p>
<p><code>catå‡å¤§å“¥</code> ä¸€å¬è¦æ‰¾<code>Eat</code> è‡ªå·±ä¹Ÿä¸çŸ¥é“æ€ä¹ˆæ•´å•Š!  ä¸è¿‡æ­¤æ—¶çªç„¶æƒ³èµ·æ¥äº†,è‡ªå·±æ˜¯æœ‰<code>super</code>è¿™ä¸ªkeyçš„,æ‰€ä»¥å®šä¹‰çš„æ—¶å€™ä¸Šå¸ä¹Ÿç»™è‡ªå·±æ‰¾äº†ä¸€ä¸ªå¤§å“¥çš„!</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> superFromArg <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">setmetatable</span>(NewClassMetatableCore, &#123;<span class="built_in">__index</span> =</span><br><span class="line">        <span class="function"><span class="keyword">function</span><span class="params">(t, k)</span></span></span><br><span class="line">            <span class="keyword">local</span> ret = mAllClassMetatableCoreCache[superFromArg][k]</span><br><span class="line">            NewClassMetatableCore[k] = ret</span><br><span class="line">            <span class="keyword">return</span> ret</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    &#125;)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>ç¿»è¯‘ä¸€ä¸‹ä¸Šé¢çš„ä»£ç å°±æ˜¯</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">local</span> catå‡å¤§å“¥çš„å¤§å“¥ = &#123;&#125;</span><br><span class="line">catå‡å¤§å“¥çš„å¤§å“¥.<span class="built_in">__index</span> = ä¸€ä¸ªæŸ¥è¯¢æ–¹æ³•</span><br><span class="line"></span><br><span class="line"><span class="built_in">setmetatable</span>(catå‡å¤§å“¥çš„å¤§å“¥,catå‡å¤§å“¥çš„å¤§å“¥)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ç‰¹æ„æŠŠé‡Œé¢çš„<code>key</code>æ¢æˆäº†<code>superFromArg</code>,å› ä¸ºè¿™å—éå¸¸å®¹æ˜“å’Œè‡ªå·±èº«ä¸Šçš„<code>super</code>keyæ··æ·†.  è¿™ä¸ª<code>æŸ¥è¯¢æ–¹æ³•</code>ç›´æ¥å–å¾—æ˜¯ç±»å®šä¹‰æ—¶å€™çš„<code>superFromArg</code>(closureé—­åŒ…),å’Œ<code>catå‡å¤§å“¥</code>æ²¡æœ‰ä»€ä¹ˆå…³ç³»çš„,</p>
<p><code>catå‡å¤§å“¥</code>çœ‹åˆ°çš„ å°±æ˜¯ä¸€ä¸ªæ™®é€šæ–¹æ³•è€Œå·²</p>
<p>ç»§ç»­ä¸Šé¢çš„åˆ†æå°±æ˜¯,<code>catå‡å¤§å“¥</code>é€šè¿‡è¿™ä¸ªæŸ¥è¯¢æ–¹æ³• æ‰¾åˆ°äº†<code>Eat</code>è¿™ç©æ„,ç„¶åä¸€è·¯é€’å½’è¿”å›ç»™<code>å°C</code>,<code>å°C</code>æ‹¿ç€Eatå°±å»è‡ªå·±æ„‰å¿«çš„ç©è€äº†.</p>
<p>æ³¨æ„è¿™ä¸ª<code>æŸ¥è¯¢æ–¹æ³•</code>é‡Œé¢æœ‰ä¸€è¡Œæ˜¯</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NewClassMetatableCore[k] = ret</span><br></pre></td></tr></table></figure>
<p>è¿™ä¹Ÿå°±æ˜¯é£ç¥è‡ªå·±åšå®¢ä¸‹æ–¹æœ‰ä¸ªå…„å¼Ÿç•™è¨€è¯´çš„<code>Write On Use</code>. ä¹Ÿå°±æ˜¯ å°C ç¬¬äºŒæ¬¡è®¿é—®Eatæ“ä½œæ—¶å€™,<code>catå‡å¤§å“¥</code>å°±çŸ¥é“<code>Eat</code>äº†,ä¸ä¼šå†é€šè¿‡<code>æŸ¥è¯¢æ–¹æ³•</code>ä»<code>mAllClassMetatableCoreCache</code>è¿™ä¸ªå¤§Tableä¸­è¿›è¡ŒæŸ¥è¯¢äº†.</p>
<h2 id="CatClass-super-SayHI-self-msg-é—®é¢˜"><a href="#CatClass-super-SayHI-self-msg-é—®é¢˜" class="headerlink" title="CatClass.super.SayHI(self, _msg) é—®é¢˜"></a>CatClass.super.SayHI(self, _msg) é—®é¢˜</h2><p>åœ¨<code>Quick</code>ç‰ˆæœ¬ä¸­è¿™è¡Œæ˜¯å¯ä»¥æ‰§è¡Œçš„,ä¹Ÿå°±æ˜¯å­ç±»Overrideäº†çˆ¶ç±»,ç„¶åè¿˜è¦è°ƒç”¨çˆ¶ç±»çš„è¿™ä¸ªæ–¹æ³•. è¿™ä¸ªè°ƒç”¨æ–¹å¼åœ¨é£ç¥çš„ç‰ˆæœ¬ä¸­ä¸èƒ½è¿™æ ·å®ç°.</p>
<p>æœ‰æ„æ€çš„æ˜¯,æˆ‘æ— æ„ä¸­<code>Google</code>è¿˜<code>Google</code>åˆ°ä¸€ä½å¤§ä½œå®¶å°è¯•ç€è§£å†³è¿™ä¸ªé—®é¢˜å‘¢! </p>
<p>å¤§ä½œå®¶ä¹Ÿæ˜¯ä¸ªç¥äºº å…ˆæ˜¯åœ¨ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­äº‘é‡Œæ¥é›¾é‡Œå»çš„åˆ†æäº†ä¸€é€š,ç„¶åå› ä¸ºæ‰€ä»¥ç§‘å­¦é“ç† å°±ç›´æ¥å¾—å‡ºäº†ä¸€äº› å¾ˆå¥‡æ€ªçš„ ç»“è®º. æ¥ç€åˆåœ¨ç¬¬äºŒç¯‡æ–‡ç« é‡Œé¢æŒ‡å‡ºäº†è¿™ä¸ªæ— æ³•è°ƒç”¨Superçš„é—®é¢˜. æ¥ç€ç»™å‡ºä¸€ä¸ªå¤§ä½œå®¶ç‰ˆçš„å®ç°.</p>
<p>æŠ›å¼€ä½œå®¶ä¸è¯´,åº•ä¸‹æœ‰ä½ä»å…„åº”è¯¥ä¹Ÿæ˜¯é‡åˆ°äº†è¿™ä¸ªé—®é¢˜, ç„¶åç»™å‡ºäº†ä¸€ä¸ª <a href="https://blog.csdn.net/yxriyin/article/details/78923257" target="_blank" rel="noopener">ä»–è‡ªå·±çš„é€’å½’è§£å†³æ³•</a></p>
<p>å…¶å®é£ç¥è¿™ç‰ˆå®ç°æ˜¯å¯ä»¥å®Œæˆè°ƒç”¨Superçš„,æ–¹æ³•å¦‚ä¸‹:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CatClass:SayHI</span><span class="params">(_msg)</span></span></span><br><span class="line"> 	<span class="built_in">print</span>(<span class="string">"[Override] CatClass start"</span>)</span><br><span class="line">	<span class="keyword">local</span> mtCat =<span class="built_in">getmetatable</span>(self).<span class="built_in">__index</span></span><br><span class="line">	<span class="keyword">local</span> mtCatMt =<span class="built_in">getmetatable</span>(mtCat)</span><br><span class="line">	<span class="keyword">local</span> superF = mtCatMt.<span class="built_in">__index</span>(<span class="literal">nil</span>,<span class="string">"SayHI"</span>)</span><br><span class="line">	superF(self,_msg)</span><br><span class="line">  <span class="comment">--CatClass.super.SayHI(self, _msg)</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"[Override] CatClass called"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>ç”¨è¿™ä¸ªæ–¹æ³•æ›¿æ¢åŸæ¥<code>Cat</code>çš„SayHIå®ç°å³å¯. å…·ä½“ä¸ºå•¥è¿™æ ·å†™å¯ä»¥ ,æˆ‘ä¹Ÿå­¦ä¸‹å¤§ä½œå®¶å¥½äº†. </p>
<blockquote>
<p>è¿™ä¸ªé“ç†å¾ˆç®€å•,è¯·è¯»è€…è‡ªè¡Œæ€è€ƒä¸€ä¸‹å³å¯. æ¥æ¥ç€å¬æˆ‘å¿½æ‚ åˆ«çš„. ğŸ˜‚</p>
</blockquote>
<p>anyway,æˆ‘è§‰å¾—å¦‚æœæœ‰å…´è¶£ä½ å¯ä»¥è‡ªå·±å°è¯•ä¸€ä¸‹ ä¸ºä½•è¿™æ ·å†™å¯ä»¥. å¦‚æœèƒ½æ¨å‡ºæ¥ è¯´æ˜æˆ‘ä¸Šé¢å¿½æ‚ çš„é‚£ä¸€å †è¿˜æ˜¯æœ‰äº›ç”¨å¤„çš„ğŸ˜.</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>é£ç¥è¿™ä¸ªOOPå®ç° å¯¹æˆ‘æ¥è¯´æœ€å¤§çš„æ”¶è· å°±å¥½æ¯”ä¸Šå­¦æ—¶å€™åšå¯¹äº†å·å­æœ€åçš„é™„åŠ é¢˜ğŸ˜‚  è®©æˆ‘å¯¹Luaä¼¼ä¹åˆæ˜ç™½äº†ä¸€äº›. æ© æ¬ä¸çŸ¥è€»çš„è¯´ ä¼¼ä¹æ„Ÿè§‰è‡ªå·±æ˜¯ ä»å…¥é—¨åˆ°å…¥äº†é—¨â€¦</p>
<p>è‡³äºä»£ç å±‚é¢ä¸Šæ¥è¯´,ç›¸æ¯”Quickç‰ˆ åŠŸèƒ½ä¸Šå¤šå®ç°äº†ä¸€ä¸ª<code>Write On Use</code>,ç„¶åæ„é€ å‡½æ•°æ˜¯è‡ªåŠ¨é€’å½’ä¸‹å»æ‰§è¡Œçš„ æ— éœ€æ‰‹åŠ¨è°ƒç”¨äº†. ä¸è¿‡è¿™éƒ¨åˆ†åœ¨Quickç‰ˆæœ¬çš„ä»£ç ä¸­æ˜¯æ¯”è¾ƒå¥½æ”¹é€ çš„. è¯¦æƒ…å‚è§<a href="905e8b50-ae97-11e8-980c-c39a9b9cf992">æˆ‘è‡ªå·±æ”¹é€ çš„ç‰ˆæœ¬</a></p>
<p>å…¶ä»–çš„ æ„Ÿè§‰å°±æ˜¯å°†Classçš„Metatableè—å¾—æ›´æ·±äº†ä¸€äº›,ä¸è¿‡è¿™ä¹ˆåšçš„å¥½å¤„ æˆ‘è¿™ä¸ªè¿˜åœ¨ä¸Šå­¦å‰ç­çš„å°å­¦ç«¥ ç›®å‰è¿˜æ— æ³•getåˆ°.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/91a7d430-ae97-11e8-8886-2901af87d97e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="éš”å£è€ç‹">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="éš”å£è€ç‹">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/91a7d430-ae97-11e8-8886-2901af87d97e/" itemprop="url">Luaä»å…¥é—¨åˆ°å…¥äº†é—¨(4) OOPæ·±å…¥åˆ†æä¹‹QuickXç‰ˆ</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-09-02T18:00:04+08:00">
                2018-09-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ç¼–ç¨‹/" itemprop="url" rel="index">
                    <span itemprop="name">ç¼–ç¨‹</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="åŸå§‹å®ç°"><a href="#åŸå§‹å®ç°" class="headerlink" title="åŸå§‹å®ç°"></a>åŸå§‹å®ç°</h2><p><a href="https://github.com/chukong/quick-cocos2d-x/blob/master/framework/functions.lua" target="_blank" rel="noopener">quick-cocos2d-xç‰ˆ</a></p>
<p>åœ¨<code>functions.lua</code>å‡½æ•°281è¡Œå¼€å§‹ ç»™å‡ºäº†<code>class</code>çš„å®ç°æ–¹å¼</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">class</span><span class="params">(classname, super)</span></span></span><br><span class="line">    <span class="keyword">local</span> superType = <span class="built_in">type</span>(super)</span><br><span class="line">    <span class="keyword">local</span> cls</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> superType ~= <span class="string">"function"</span> <span class="keyword">and</span> superType ~= <span class="string">"table"</span> <span class="keyword">then</span></span><br><span class="line">        superType = <span class="literal">nil</span></span><br><span class="line">        super = <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> superType == <span class="string">"function"</span> <span class="keyword">or</span> (super <span class="keyword">and</span> super.__ctype == <span class="number">1</span>) <span class="keyword">then</span></span><br><span class="line">        <span class="comment">-- inherited from native C++ Object</span></span><br><span class="line">        cls = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> superType == <span class="string">"table"</span> <span class="keyword">then</span></span><br><span class="line">            <span class="comment">-- copy fields from super</span></span><br><span class="line">            <span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">pairs</span>(super) <span class="keyword">do</span> cls[k] = v <span class="keyword">end</span></span><br><span class="line">            cls.__create = super.__create</span><br><span class="line">            cls.super    = super</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            cls.__create = super</span><br><span class="line">            cls.ctor = <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        cls.__cname = classname</span><br><span class="line">        cls.__ctype = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">cls.new</span><span class="params">(...)</span></span></span><br><span class="line">            <span class="keyword">local</span> instance = cls.__create(...)</span><br><span class="line">            <span class="comment">-- copy fields from class to native object</span></span><br><span class="line">            <span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">pairs</span>(cls) <span class="keyword">do</span> instance[k] = v <span class="keyword">end</span></span><br><span class="line">            instance.class = cls</span><br><span class="line">            instance:ctor(...)</span><br><span class="line">            <span class="keyword">return</span> instance</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">-- inherited from Lua Object</span></span><br><span class="line">        <span class="keyword">if</span> super <span class="keyword">then</span></span><br><span class="line">            cls = &#123;&#125;</span><br><span class="line">            <span class="built_in">setmetatable</span>(cls, &#123;<span class="built_in">__index</span> = super&#125;)</span><br><span class="line">            cls.super = super</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            cls = &#123;ctor = <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="keyword">end</span>&#125;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        cls.__cname = classname</span><br><span class="line">        cls.__ctype = <span class="number">2</span> <span class="comment">-- lua</span></span><br><span class="line">        cls.<span class="built_in">__index</span> = cls</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">cls.new</span><span class="params">(...)</span></span></span><br><span class="line">            <span class="keyword">local</span> instance = <span class="built_in">setmetatable</span>(&#123;&#125;, cls)</span><br><span class="line">            instance.class = cls</span><br><span class="line">            instance:ctor(...)</span><br><span class="line">            <span class="keyword">return</span> instance</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cls</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>å°†å¦‚ä¸Šå‡½æ•°ä¿å­˜ä¸º<code>ClassQ.lua</code></p>
<p>å†åˆ›å»ºå¦‚ä¸‹æ–‡ä»¶</p>
<p><code>Animal.lua</code></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">AnimalClass = class(<span class="string">"AnimalClass"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AnimalClass:ctor</span><span class="params">(_name)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"call animal ctor name is: "</span>.._name)</span><br><span class="line">    self.mName = _name</span><br><span class="line">    self.mFood = <span class="string">"normal food"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AnimalClass:SayHI</span><span class="params">(_msg)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"Animal %s say hi with msg : %s"</span>, self.mName, _msg))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AnimalClass:Eat</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"Animal %s eat with food : %s"</span>, self.mName, self:GetEatFood()))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AnimalClass:GetEatFood</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> self.mFood</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p><code>Cat.lua</code></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CatClass = class(<span class="string">"CatClass"</span>,AnimalClass)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CatClass:ctor</span><span class="params">(_name, _color)</span></span></span><br><span class="line">    CatClass.super.ctor(self, _name)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"call cat ctor name is: %s color is %s"</span>, _name, _color))</span><br><span class="line">    self.mColor = _color</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CatClass:SayHI</span><span class="params">(_msg)</span></span></span><br><span class="line">    CatClass.super.SayHI(self, _msg)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[Override] CatClass called"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CatClass:GetEatFood</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Fish"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>å…¥å£æ–‡ä»¶<code>main.lua</code></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">"ClassQ"</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"Animal"</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"Cat"</span>)</span><br><span class="line"></span><br><span class="line">a1 = AnimalClass.new(<span class="string">"A1"</span>)</span><br><span class="line">a1:SayHI(<span class="string">"oh~"</span>)</span><br><span class="line">a1:Eat()</span><br><span class="line"></span><br><span class="line">c1 = CatClass.new(<span class="string">"C1"</span>,<span class="string">"Red"</span>)</span><br><span class="line">c1:SayHI(<span class="string">"oh~"</span>)</span><br><span class="line">c1:Eat()</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœä¸º:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">call animal ctor name is: A1</span><br><span class="line">Animal A1 say hi with msg : oh~</span><br><span class="line">Animal A1 eat with food : normal food</span><br><span class="line"></span><br><span class="line">call animal ctor name is: C1</span><br><span class="line">call cat ctor name is: C1 color is Red</span><br><span class="line"></span><br><span class="line">Animal C1 say hi with msg : oh~</span><br><span class="line">[Override] CatClass called</span><br><span class="line"></span><br><span class="line">Animal C1 eat with food : Fish</span><br></pre></td></tr></table></figure>
<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><h3 id="åˆ å‡"><a href="#åˆ å‡" class="headerlink" title="åˆ å‡"></a>åˆ å‡</h3><p><code>QuickX</code>æœ‰ä¸€éƒ¨åˆ†æ˜¯ä¸ºäº†è¦è€ƒè™‘ç›´æ¥å’Œå¼•æ“C++å±‚ç»‘å®š,è¿™éƒ¨åˆ†ä¸åœ¨æˆ‘ä»¬çš„è®¨è®ºèŒƒå›´ä¸­. æ‰€ä»¥å°†å…¶classå‡½æ•°ä¸­ç›¸å…³éƒ¨åˆ†ä»£ç å»æ‰.</p>
<p>æœ€ç»ˆä»£ç ä¸º:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">class</span><span class="params">(classname, super)</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> cls</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- inherited from Lua Object</span></span><br><span class="line">    <span class="keyword">if</span> super <span class="keyword">then</span></span><br><span class="line">        cls = &#123;&#125;</span><br><span class="line">        <span class="built_in">setmetatable</span>(cls, &#123;<span class="built_in">__index</span> = super&#125;)</span><br><span class="line">        cls.super = super</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        cls = &#123;ctor = <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="keyword">end</span>&#125;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    cls.__cname = classname</span><br><span class="line">    cls.<span class="built_in">__index</span> = cls</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">cls.new</span><span class="params">(...)</span></span></span><br><span class="line">        <span class="keyword">local</span> instance = <span class="built_in">setmetatable</span>(&#123;&#125;, cls)</span><br><span class="line">        instance.class = cls</span><br><span class="line">        instance:ctor(...)</span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cls</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="ç­‰æ•ˆè½¬æ¢"><a href="#ç­‰æ•ˆè½¬æ¢" class="headerlink" title="ç­‰æ•ˆè½¬æ¢"></a>ç­‰æ•ˆè½¬æ¢</h3><p>æ¥ç€å’Œä¹‹å‰ä¸€æ · æˆ‘ä»¬å†æŠŠè¿™éƒ¨åˆ†ä»£ç  æ”¹äº›åå­—,å»é™¤ä¸ªè¯­æ³•ç³–  <strong>ç­‰æ•ˆ</strong> çš„æ”¹æˆå¦‚ä¸‹ä»£ç :</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">class</span><span class="params">(classname, super)</span></span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">local</span> newClass</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- inherited from Lua Object</span></span><br><span class="line">    <span class="keyword">if</span> super <span class="keyword">then</span></span><br><span class="line">        newClass = &#123;&#125;</span><br><span class="line">        <span class="built_in">setmetatable</span>(newClass, &#123;<span class="built_in">__index</span> = super&#125;)</span><br><span class="line">        newClass.super = super</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        newClass = &#123;ctor = <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="keyword">end</span>&#125;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    newClass.__cname = classname</span><br><span class="line">    newClass.<span class="built_in">__index</span> = newClass</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">newClass.new</span><span class="params">(...)</span></span></span><br><span class="line">        <span class="keyword">local</span> instance = &#123;&#125;</span><br><span class="line">        <span class="built_in">setmetatable</span>(instance, newClass)</span><br><span class="line">        instance.class = newClass</span><br><span class="line">        instance:ctor(...)</span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> newClass</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="æ‹†è§£åˆ†æ"><a href="#æ‹†è§£åˆ†æ" class="headerlink" title="æ‹†è§£åˆ†æ"></a>æ‹†è§£åˆ†æ</h3><h4 id="äº‹å…ˆäº†è§£"><a href="#äº‹å…ˆäº†è§£" class="headerlink" title="äº‹å…ˆäº†è§£"></a>äº‹å…ˆäº†è§£</h4><blockquote>
<p> å¦‚æœä½ å¯¹ä¸ºä½•èƒ½ç­‰æ•ˆè½¬æ¢åŠ2Bæƒ…æ™¯æ³•æœ‰ç–‘é—®,è¯·çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« : <a href="http://oldking.wang/fe8c5fe0-ae96-11e8-abfb-e54ee4891837/" target="_blank" rel="noopener">Luaä»å…¥é—¨åˆ°å…¥äº†é—¨(2) åŸºç¡€éš¾ç‚¹æ¦‚è¿°</a></p>
</blockquote>
<h4 id="new-å‡½æ•°"><a href="#new-å‡½æ•°" class="headerlink" title="new å‡½æ•°"></a>new å‡½æ•°</h4><p>é¦–å…ˆè¦æ‹†å¼€äº†æ¥çœ‹, å…ˆçœ‹newå‡½æ•°éƒ¨åˆ†</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">--å‡½æ•°å®šä¹‰</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newClass.new</span><span class="params">(...)</span></span></span><br><span class="line">        <span class="keyword">local</span> instance = &#123;&#125;</span><br><span class="line">        <span class="built_in">setmetatable</span>(instance, newClass)</span><br><span class="line">        instance.class = newClass</span><br><span class="line">        instance:ctor(...)</span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">a1 = AnimalClass.new(<span class="string">"A1"</span>)</span><br><span class="line">c1 = CatClass.new(<span class="string">"C1"</span>,<span class="string">"Red"</span>)</span><br></pre></td></tr></table></figure>
<p>è¿™éƒ¨åˆ†å¾ˆç®€ç­”, å°±æ˜¯æŠŠå°å¼Ÿå’Œå¤§å“¥å…³è”äº†ä¸€ä¸‹. é¡ºä¾¿è°ƒç”¨äº†ä¸€ä¸‹å°å¼Ÿçš„<code>ctor</code>å‡½æ•° è®©å…¶åˆå§‹åŒ–ä»¥ä¸‹.</p>
<h4 id="class-å®šä¹‰éƒ¨åˆ†"><a href="#class-å®šä¹‰éƒ¨åˆ†" class="headerlink" title="class å®šä¹‰éƒ¨åˆ†"></a>class å®šä¹‰éƒ¨åˆ†</h4><p>æ¯”è¾ƒç»•çš„æ˜¯classå®šä¹‰éƒ¨åˆ†</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">--å‡½æ•°å®šä¹‰</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">class</span><span class="params">(classname, super)</span></span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">local</span> newClass</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- inherited from Lua Object</span></span><br><span class="line">    <span class="keyword">if</span> super <span class="keyword">then</span></span><br><span class="line">        newClass = &#123;&#125;</span><br><span class="line">        <span class="built_in">setmetatable</span>(newClass, &#123;<span class="built_in">__index</span> = super&#125;)</span><br><span class="line">        newClass.super = super</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        newClass = &#123;ctor = <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="keyword">end</span>&#125;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    newClass.__cname = classname</span><br><span class="line">    newClass.<span class="built_in">__index</span> = newClass</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> newClass</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--è°ƒç”¨æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">AnimalClass = class(<span class="string">"AnimalClass"</span>)</span><br><span class="line">CatClass = class(<span class="string">"CatClass"</span>,AnimalClass)</span><br></pre></td></tr></table></figure>
<h5 id="AnimalClass"><a href="#AnimalClass" class="headerlink" title="AnimalClass"></a>AnimalClass</h5><p>å®šä¹‰å°açš„å¤§å“¥<code>AnimalClass</code>æ—¶å€™,å¤§å“¥å°±æ˜¯ä¸€ä¸ªå«æœ‰ctorå‡½æ•°çš„ç©ºè¡¨,æ³¨æ„æ­¤æ—¶<code>AnimalClass</code>è¿˜ä¸æ˜¯å°açš„å¤§å“¥,åªæ˜¯ä¸€å¼ æ™®é€šçš„tableè€Œå·². æ‰€ä»¥</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">newClass.<span class="built_in">__index</span> = newClass</span><br></pre></td></tr></table></figure>
<p>è¿™è¡Œå®šä¹‰ åªæ˜¯æ‰¾äº†ä¸€ä¸ªåå­—å«<code>__index</code>çš„Key,è®©å…¶å€¼åˆå¼•ç”¨äº†å…¶è‡ªèº«, åªæœ‰å½“åˆ›å»ºå°aæ—¶å€™</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a1 = AnimalClass.new(<span class="string">"A1"</span>)</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶<code>AnimalClass</code>æ‰æˆäº†å°açš„å¤§å“¥,<code>AnimalClass.__index=AnimalClass</code>æ‰ç­‰æ•ˆä¸ä¹‹å‰ä¾‹å­ä¸­çš„<code>GreenPaper</code>(åœ¨ä¹‹å‰çš„æ•™ç¨‹ä¸­)</p>
<h5 id="CatClass"><a href="#CatClass" class="headerlink" title="CatClass"></a>CatClass</h5><p><code>CatClass</code>æœ‰åˆ«ä¸<code>AnimalClass</code>,å®šä¹‰æ—¶å€™æ˜¯æœ‰superçš„. æ‰€ä»¥å°±æ˜¯ç›¸å½“äº è®¾ç½®äº† å¤§å“¥çš„å¤§å“¥.</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">--è°ƒç”¨è¿™è¡Œ</span></span><br><span class="line">CatClass = class(<span class="string">"CatClass"</span>,AnimalClass)</span><br><span class="line"><span class="comment">--å¸¦å…¥åˆ™å˜ä¸º</span></span><br><span class="line"><span class="built_in">setmetatable</span>(CatClass, &#123;<span class="built_in">__index</span> = AnimalClass&#125;)</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥å½“å°c(c1) è°ƒç”¨æŸä¸ªå‡½æ•°æ—¶å€™ é¦–å…ˆé—®å…¶å¤§å“¥<code>CatClass</code>,</p>
<blockquote>
<p>c1å…¶å®åªåŒ…å«äº†æ•°æ®,éƒ½æ˜¯ é€šè¿‡ <code>self.mColor=xxx</code> è¿™ç§åœ¨æŸäº›å‡½æ•°ä¸­å®šä¹‰çš„,è‡ªèº«æ˜¯ä¸åŒ…å«ä»»ä½•å‡½æ•°çš„. æ‰€ä»¥å¤–é¢ä¸€è°ƒç”¨<code>c1:SayHI()</code> è¿™ç§å‡½æ•° <code>c1</code>ä¸­è‚¯å®šæ˜¯æ²¡æœ‰çš„,æ‰€ä»¥å°±ä¼šå»å‘å…¶å¤§å“¥æ±‚æ•‘</p>
</blockquote>
<p>å¤§å“¥æŸ¥äº†ä¸€ä¸‹è‡ªå·±å‘ç°è‡ªå·±ä¹Ÿæä¸å®š</p>
<blockquote>
<p>å¤§å“¥ä¹‹æ‰€ä»¥ä¼šæŸ¥è‡ªå·±,æ˜¯å› ä¸ºä¸Šé¢<code>newClass.__index = newClass</code>è®¾ç½®çš„,å¤§å“¥è‡ªå·±èƒ½æå¾—å®šçš„æƒ…å†µå°±æ˜¯è¯´æ˜å­ç±»Overrideäº†çˆ¶ç±»çš„æ–¹æ³•äº†.ä¹Ÿå°±æ˜¯å¤§å“¥ä¸­æœ‰è¿™ä¸ªå®ç°. æ¯”å¦‚ä¾‹å­ä¸­çš„<code>CatClass:SayHI</code>. æ²¡æœ‰å®ç°çš„ æ¯”å¦‚<code>CatClass:Eat</code> å°±æ˜¯å¤§å“¥è‡ªå·±ä¹Ÿæä¸å®šçš„æƒ…å†µäº†.</p>
</blockquote>
<p>å¤§å“¥(CatClass)æä¸å®šå°±å»é—®äº†å…¶å¤§å“¥çš„å¤§å“¥<code>AnimalClass</code></p>
<blockquote>
<p><code>CatClass</code>ä¼šå»é—®<code>AnimalClass</code> æ˜¯å› ä¸ºè®¾ç½®äº†<code>setmetatable(newClass, {__index = super})</code> , è¿™éƒ¨åˆ†æœ‰ç‚¹ç»• æ¶‰åŠåˆ°ç‚¹æœ‰å‡ ä¸ª</p>
<ol>
<li><p><code>CatClass</code>æ˜¯c1çš„å…ƒè¡¨,ä½†æ˜¯å…¶è‡ªèº«ä¹Ÿæ˜¯è¡¨,ä»–ä¹Ÿæ˜¯å¯ä»¥æœ‰å…ƒè¡¨çš„</p>
</li>
<li><p><code>CatClass</code>çš„å…ƒè¡¨ å¹¶ä¸æ˜¯ <code>AnimalClass</code> ğŸ˜ æƒŠä¸æƒŠå–œ?æ„ä¸æ„å¤–? è¯¦æƒ…å¯ä»¥çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« , å°±æ˜¯çœŸå¤§å“¥,å‡å¤§å“¥é‚£å—.</p>
</li>
<li><p><code>CatClass</code>åªæœ‰è‡ªå·±æŸ¥ä¸åˆ°çš„æƒ…å†µä¸‹æ‰ä¼šå‘<code>AnimalClass</code>æ±‚æ•‘çš„. è¿™ä¹Ÿæ˜¯æˆ‘ä¹‹å‰ä¸€ç›´æ¯”è¾ƒæ‡µåœˆçš„åœ°æ–¹. ç”¨2Bæƒ…æ™¯æ³•æ¥æè¿°å°±æ˜¯</p>
</li>
</ol>
<p>å°å¼Ÿ(c1)å…ˆè‡ªå·±è§£å†³,è§£å†³ä¸äº†æ‰¾å¤§å“¥(CatClass)<br>å°å¼Ÿ(CatClass)å…ˆè‡ªå·±è§£å†³,è§£å†³ä¸äº†æ‰¾å¤§å“¥(AnimalClass)</p>
<p>è¿™æ ·ä¸€å±‚ä¸€å±‚å°±é€’å½’ä¸‹å»äº†</p>
</blockquote>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>Quickè¿™ä¸ªå®ç°ç‰ˆæœ¬åŸºæœ¬ä¸Šæ¥è¯´å·²ç»å¤Ÿç”¨äº†,ä¸è¿‡è°ƒç”¨æ—¶å€™æœ‰å‡ ä¸ªç‚¹è¦æ³¨æ„</p>
<h3 id="newå‡½æ•°éœ€è¦ç”¨-çš„æ–¹å¼æ¥è°ƒç”¨-å…¶ä»–å‡½æ•°å´éœ€è¦ç”¨-æ¥è°ƒç”¨"><a href="#newå‡½æ•°éœ€è¦ç”¨-çš„æ–¹å¼æ¥è°ƒç”¨-å…¶ä»–å‡½æ•°å´éœ€è¦ç”¨-æ¥è°ƒç”¨" class="headerlink" title="newå‡½æ•°éœ€è¦ç”¨ .çš„æ–¹å¼æ¥è°ƒç”¨,å…¶ä»–å‡½æ•°å´éœ€è¦ç”¨:æ¥è°ƒç”¨"></a>newå‡½æ•°éœ€è¦ç”¨ <code>.</code>çš„æ–¹å¼æ¥è°ƒç”¨,å…¶ä»–å‡½æ•°å´éœ€è¦ç”¨<code>:</code>æ¥è°ƒç”¨</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">--æ­£ç¡®çš„</span></span><br><span class="line">a1 = AnimalClass.new(<span class="string">"A1"</span>) </span><br><span class="line"><span class="comment">--é”™è¯¯çš„</span></span><br><span class="line">a1 = AnimalClass:new(<span class="string">"A1"</span>)</span><br></pre></td></tr></table></figure>
<p>åŸå› æ˜¯å› ä¸ºå…¶newå‡½æ•°å£°æ˜æ—¶å€™ç”¨çš„ç‚¹,å†…éƒ¨instanceç”¨çš„æ˜¯å†’å·,è¿™æ ·ç”¨å†’å·å»è°ƒç”¨newå‡½æ•°æ—¶å€™ä¼šå¤šå¾€ctorä¸­ä¼ ä¸€ä¸ªâ€selfâ€(è¿™ä¸ªselfå…¶å®æ˜¯Class)</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">a1 = AnimalClass:new(<span class="string">"A1"</span>)</span><br><span class="line"><span class="comment">--ç­‰é˜¶ä¸</span></span><br><span class="line">a1 = AnimalClass.new(AnimalClass,<span class="string">"A1"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--newå‡½æ•°å†…éƒ¨è°ƒç”¨</span></span><br><span class="line">instance:ctor(...)</span><br><span class="line"><span class="comment">--ç­‰é˜¶ä¸</span></span><br><span class="line">instance.ctor(instance,...)</span><br><span class="line"></span><br><span class="line"><span class="comment">--å¸¦å…¥ä¸Šé¢çš„a1å’Œå®é™…å‚æ•°åˆ™ä¸º</span></span><br><span class="line">a1.ctor(a1,AnimalClass,<span class="string">"A1"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--ä½†æ˜¯Animalçš„ctorå®šä¹‰ä¸º</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AnimalClass:ctor</span><span class="params">(_name)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">--æ‰€ä»¥ç”¨AnimalClass:new("A1")è°ƒç”¨çš„è¯ _nameå¾—åˆ°çš„æ˜¯AnimalClass,"A1"è¿™ä¸ªå‚æ•°å°±ä¸¢å¤±äº†</span></span><br></pre></td></tr></table></figure>
<h3 id="å¯ä»¥å®ç°å­ç±»é‡è½½åè¿˜èƒ½è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•åªä¸è¿‡å®ç°èµ·æ¥çœ‹ç€ä¼šæ¯”è¾ƒè¯¡å¼‚"><a href="#å¯ä»¥å®ç°å­ç±»é‡è½½åè¿˜èƒ½è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•åªä¸è¿‡å®ç°èµ·æ¥çœ‹ç€ä¼šæ¯”è¾ƒè¯¡å¼‚" class="headerlink" title="å¯ä»¥å®ç°å­ç±»é‡è½½åè¿˜èƒ½è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•åªä¸è¿‡å®ç°èµ·æ¥çœ‹ç€ä¼šæ¯”è¾ƒè¯¡å¼‚"></a>å¯ä»¥å®ç°å­ç±»é‡è½½åè¿˜èƒ½è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•åªä¸è¿‡å®ç°èµ·æ¥çœ‹ç€ä¼šæ¯”è¾ƒè¯¡å¼‚</h3><p>æ¯”å¦‚<code>Cat</code>ä¸­çš„SayHIå‡½æ•°</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CatClass<span class="selector-class">.super</span><span class="selector-class">.SayHI</span>(self, _msg)</span><br></pre></td></tr></table></figure>
<p>ç†è§£èµ·æ¥å…¶å®å€’æ˜¯ä¸éš¾, <code>CatClass.super</code> ä¹Ÿå°±æ˜¯ <code>AnimalClass</code></p>
<p>ä¹Ÿå°±å˜æˆäº† </p>
<p><code>AnimalClass.SayHI(self, _msg)</code></p>
<p>æ­¤æ—¶selfæ˜¯<code>c1</code> , ä¸èƒ½ç›´æ¥ <code>AnimalClass:SayHI(_msg)</code> ,å› ä¸ºè¿™æ ·å°±æ²¡æŠŠ<code>c1</code>ä¼ è¿‡å». ç›¸å½“äºè¡¨å„¿ä¼ é”™äº†</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/001ee6c0-ae97-11e8-ac40-db55252f3df1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="éš”å£è€ç‹">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="éš”å£è€ç‹">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/001ee6c0-ae97-11e8-ac40-db55252f3df1/" itemprop="url">Luaä»å…¥é—¨åˆ°å…¥äº†é—¨(3) OOPæ·±å…¥åˆ†æä¹‹æ•™ç§‘ä¹¦ç‰ˆ</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-09-02T18:00:03+08:00">
                2018-09-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ç¼–ç¨‹/" itemprop="url" rel="index">
                    <span itemprop="name">ç¼–ç¨‹</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="åŸå§‹å®ç°"><a href="#åŸå§‹å®ç°" class="headerlink" title="åŸå§‹å®ç°"></a>åŸå§‹å®ç°</h2><p><a href="http://www.lua.org/pil/16.2.html" target="_blank" rel="noopener">æºä»£ç åœ°å€http://www.lua.org/pil/16.2.html</a></p>
<p>æˆ‘åšäº†äº›è®¸æ”¹å˜,ä»£ç å¦‚ä¸‹:</p>
<p>Account.luaæ–‡ä»¶</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Account = &#123;balance = <span class="number">0</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Account:new</span> <span class="params">(o)</span></span></span><br><span class="line">    o = o <span class="keyword">or</span> &#123;&#125;</span><br><span class="line">    <span class="built_in">setmetatable</span>(o, self)</span><br><span class="line">    self.<span class="built_in">__index</span> = self</span><br><span class="line">    <span class="keyword">return</span> o</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Account:deposit</span> <span class="params">(v)</span></span></span><br><span class="line">    self.balance = self.balance + v</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Account:withdraw</span> <span class="params">(v)</span></span></span><br><span class="line">    <span class="keyword">if</span> v &gt; self.balance <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"ä½ æ²¡é‚£ä¹ˆå¤šé’± å–ä¸å‡ºæ¥çš„ å…„å¼Ÿ"</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    self.balance = self.balance - v</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>SpecialAccount.luaæ–‡ä»¶</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SpecialAccount = Account:new()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SpecialAccount:withdraw</span> <span class="params">(v)</span></span></span><br><span class="line">    <span class="keyword">if</span> v - self.balance &gt;= self:getLimit() <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">error</span><span class="string">"insufficient funds"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    self.balance = self.balance - v</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SpecialAccount:getLimit</span> <span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> self.limit <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>å…¥å£æ–‡ä»¶</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">"Account"</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"SpecialAccount"</span>)</span><br><span class="line"></span><br><span class="line">normalAccount = Account:new()</span><br><span class="line">normalAccount:deposit(<span class="number">100.00</span>)</span><br><span class="line">normalAccount:withdraw(<span class="number">300</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"æ™®é€šè´¦æˆ·å½“å‰å­˜æ¬¾: "</span>..normalAccount.balance)</span><br><span class="line"></span><br><span class="line">sAccount = SpecialAccount:new&#123;limit = <span class="number">1000.00</span>&#125;</span><br><span class="line">sAccount:deposit(<span class="number">100.00</span>)</span><br><span class="line">sAccount:withdraw(<span class="number">300</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"ç‰¹æ®Šè´¦æˆ·å½“å‰å­˜æ¬¾: "</span>..sAccount.balance)</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœ:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä½ æ²¡é‚£ä¹ˆå¤šé’± å–ä¸å‡ºæ¥çš„ å…„å¼Ÿ</span><br><span class="line">æ™®é€šè´¦æˆ·å½“å‰å­˜æ¬¾: <span class="number">100.0</span></span><br><span class="line"></span><br><span class="line">ç‰¹æ®Šè´¦æˆ·å½“å‰å­˜æ¬¾: <span class="number">-200.0</span></span><br></pre></td></tr></table></figure>
<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>OOPæ ¸å¿ƒéƒ¨åˆ†å®ç°ä»£ç å°±æ˜¯è¿™å—:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Account:new</span> <span class="params">(o)</span></span></span><br><span class="line">    o = o <span class="keyword">or</span> &#123;&#125;</span><br><span class="line">    <span class="built_in">setmetatable</span>(o, self)</span><br><span class="line">    self.<span class="built_in">__index</span> = self</span><br><span class="line">    <span class="keyword">return</span> o</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--å¤–éƒ¨è°ƒç”¨æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">normalAccount = Account:new()</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥å»é™¤è¯­æ³•ç³–,æ›´æ¢å˜é‡å å°†ä¸Šé¢ä»£ç   <strong>ç­‰æ•ˆ</strong>  è½¬åŒ–ä¸º å¦‚ä¸‹ä»£ç :</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Account.new = <span class="function"><span class="keyword">function</span> <span class="params">(_firstArg, _newTable)</span></span></span><br><span class="line">    _newTable = _newTable <span class="keyword">or</span> &#123;&#125;</span><br><span class="line">    <span class="built_in">setmetatable</span>(_newTable, _firstArg)</span><br><span class="line">    _firstArg.<span class="built_in">__index</span> = _firstArg</span><br><span class="line">    <span class="keyword">return</span> _newTable</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--å¤–éƒ¨è°ƒç”¨æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">normalAccount = Account.new(Account)</span><br></pre></td></tr></table></figure>
<p> å¦‚æœä½ å¯¹ä¸ºä½•èƒ½ç­‰æ•ˆè½¬æ¢åŠ2Bæƒ…æ™¯æ³•æœ‰ç–‘é—®,è¯·çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« : <a href="http://oldking.wang/fe8c5fe0-ae96-11e8-abfb-e54ee4891837/" target="_blank" rel="noopener">Luaä»å…¥é—¨åˆ°å…¥äº†é—¨(2) åŸºç¡€éš¾ç‚¹æ¦‚è¿°</a></p>
<p>ç„¶åè®©æˆ‘ç”¨2Bæƒ…æ™¯æ³•ç¿»è¯‘ä¸€ä¸‹ä¸Šé¢é‚£æ®µ</p>
<p><code>_newTable</code>å°±æ˜¯å°å¼Ÿ,<code>_firstArg</code>ä¹Ÿå°±æ˜¯è°ƒç”¨æ—¶å€™ä¼ å…¥çš„<code>Account</code>å°±æ˜¯å¤§å“¥</p>
<p><code>setmetatable(_newTable, _firstArg)</code> è®©å°å¼Ÿè®¤äº†å¤§å“¥</p>
<p><code>_firstArg.__index = _firstArg</code> å¤§å“¥å·æ‡’,ç›´æ¥å°†æŸ¥æ‰¾å‡½æ•°æŒ‡å‘äº†è‡ªå·±,(å‚è€ƒä¹‹å‰ä¾‹å­ä¸­GreenPaper)</p>
<p>ç„¶åç›´æ¥return äº†å°å¼Ÿ, å°å¼Ÿå°±å¯ä»¥è‡ªå·±å»æ„‰å¿«çš„ç©è€äº†.</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æ•™ç§‘ä¹¦ç»™å‡ºçš„OOPæ¨¡æ‹Ÿæ–¹å¼æ˜¯æœ€å¥½ç†è§£çš„,ä½†æ˜¯ç›¸åº”çš„ä¼šåœ¨ç¼–å†™ä¸Šç¨æ˜¾å¤æ‚. æ¯”å¦‚ <code>SpecialAccount</code>å£°æ˜æ—¶å€™è¦å»å†™ <code>SpecialAccount = Account:new()</code></p>
<p>æ‰€ä»¥è¿™ä¸ªä¾‹å­æ›´å¤šçš„æ˜¯æ•™å­¦æ„ä¹‰å¤§äºå®é™…æ„ä¹‰</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/fe8c5fe0-ae96-11e8-abfb-e54ee4891837/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="éš”å£è€ç‹">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="éš”å£è€ç‹">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/fe8c5fe0-ae96-11e8-abfb-e54ee4891837/" itemprop="url">Luaä»å…¥é—¨åˆ°å…¥äº†é—¨(2) åŸºç¡€éš¾ç‚¹æ¦‚è¿°</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-09-02T18:00:02+08:00">
                2018-09-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ç¼–ç¨‹/" itemprop="url" rel="index">
                    <span itemprop="name">ç¼–ç¨‹</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å¦‚ä½•ç»„ç»‡ä»£ç "><a href="#å¦‚ä½•ç»„ç»‡ä»£ç " class="headerlink" title="å¦‚ä½•ç»„ç»‡ä»£ç "></a>å¦‚ä½•ç»„ç»‡ä»£ç </h2><p>Luaå’ŒJSä¸€æ ·éƒ½æ˜¯<code>è§£é‡Šå‹è¯­è¨€</code>,æ²¡æœ‰å…¥å£çš„æ¦‚å¿µ. ä½†æ˜¯è¦å®ç°æ–‡ç« 1ç»“å°¾æ—¶å€™æ‰€è¯´çš„Codingç¯å¢ƒ</p>
<blockquote>
<p>å†™ä¸ªå…¥å£æ–‡ä»¶ <code>main.lua</code> ç„¶åæ¯ä¸ªç±»ä¸€ä¸ªæ–‡ä»¶ ä»å…¥å£æ–‡ä»¶çš„æŸä¸ªå‡½æ•°å¼€å§‹æ‰§è¡Œ ç„¶åæŠŠæ•´ä¸ªç¨‹åºRunèµ·æ¥</p>
</blockquote>
<p>æˆ‘èƒ½æƒ³åˆ°çš„è§£å†³æ–¹æ¡ˆæ˜¯</p>
<ol>
<li><p>é¦–å…ˆé€šè¿‡æŸç§æ–¹æ³•å¯ä»¥ç”¨Luaæ¨¡æ‹Ÿå‡ºç±»çš„æ¦‚å¿µ</p>
</li>
<li><p>å°†æ¯ä¸€ä¸ªç±»éƒ½å•ç‹¬å»ºç«‹ä¸€ä¸ª<code>*.lua</code>æ–‡ä»¶</p>
</li>
<li><p>å»ºç«‹ä¸€ä¸ª<code>Load.lua</code>å’Œ<code>Main.lua</code>æ–‡ä»¶(Main.luaä¹Ÿæ˜¯æ¨¡æ‹Ÿå‡ºæ¥çš„ç±»),<code>Main</code>ç±»é‡Œé¢æœ‰ä¸€ä¸ª<code>Start()</code>æ–¹æ³•</p>
</li>
<li><p>åœ¨<code>Load.lua</code>ä¸­é€šè¿‡<code>require</code>å‡½æ•°å°†å…¶ä½™æ‰€æœ‰çš„æ–‡ä»¶éƒ½requireè¿›æ¥,ç„¶ånewä¸€ä¸ªMainçš„å¯¹è±¡æ‰§è¡Œ<code>Start()</code>æ–¹æ³• å¼€å§‹æ•´ä¸ªç¨‹åº</p>
</li>
</ol>
<p>ä¼ªç å¦‚ä¸‹:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"ClassA"</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"ClassB"</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"ClassC"</span>)</span><br><span class="line">...</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"ClassY"</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"ClassZ"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--éƒ½requireå®Œäº†ä»¥åæ‰§è¡Œ:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> entry = Main.new();</span><br><span class="line">entry.Start();</span><br></pre></td></tr></table></figure>
<h3 id="å®é™…é¡¹ç›®"><a href="#å®é™…é¡¹ç›®" class="headerlink" title="å®é™…é¡¹ç›®"></a>å®é™…é¡¹ç›®</h3><p>å› ä¸ºæ²¡å’Œå…¶ä»–äººäº¤æµè¿‡ ä¹Ÿä¸çŸ¥é“ è¿™æ˜¯ä¸æ˜¯ä¸ªæ ‡å‡†æµç¨‹ ,ä¸è¿‡æˆ‘è‡ªå·±çš„é¡¹ç›®æ˜¯å‡†å¤‡è¿™ä¹ˆå¼„çš„. </p>
<p>ä¼šæœ‰ä¸€äº›æ”¹åŠ¨ å› ä¸ºæœ‰éƒ¨åˆ†ä»£ç åº”è¯¥ä¼šç›´æ¥å’Œ<code>GameObject</code>åšåŒå‘ç»‘å®š,æ‰€ä»¥ä¸ä¸€å®šå…¥å£æ–‡ä»¶éœ€è¦å°†æ‰€æœ‰æ–‡ä»¶éƒ½<code>require</code>è¿›æ¥,å¹¶ä¸”å…¥å£æ–‡ä»¶ä¹Ÿä¸ä¸€å®šä¼šåªæœ‰ä¸€ä¸ª.</p>
<p>å¦å¤–ä¸€ä¸ªå°±æ˜¯<code>Load.lua</code>è¿™ä¸ªæ–‡ä»¶åˆ°æ—¶å€™åº”è¯¥ä¼šæ ¹æ®æŸç§é…ç½®ç”¨ç¨‹åºç”Ÿæˆ. </p>
<p>æ¯”å¦‚<code>Lua/InitLoad/*.lua</code>ä¸‹é¢çš„æ–‡ä»¶éƒ½åˆå§‹æ—¶å€™åŠ è½½,ç„¶å<code>Lua/Manual/*.lua</code>ä¸‹é¢çš„æ–‡ä»¶éƒ½æ‰‹åŠ¨åŠ è½½.  </p>
<p>æˆ–è€…ç›´æ¥ç”¨å‰ç¼€åšåŒºåˆ† <code>Init_$ClassName.lua</code>,<code>Manual_$ClassName.lua</code></p>
<p>ä½†æ˜¯å¤§ä½“ä¸Šæ¥è¯´,ç»“æ„ä¼šæŒ‰ç…§ä¸Šé¢æ‰€è¯´çš„é‚£æ ·.</p>
<h3 id="require-ä¸­-localçš„ä½œç”¨åŸŸ"><a href="#require-ä¸­-localçš„ä½œç”¨åŸŸ" class="headerlink" title="require ä¸­ localçš„ä½œç”¨åŸŸ"></a>require ä¸­ localçš„ä½œç”¨åŸŸ</h3><p>è¿™æ˜¯æˆ‘å½“æ—¶æœ‰äº›æ²¡ææ‡‚çš„åœ°æ–¹,å°±æ˜¯local å˜é‡ä½œç”¨åŸŸçš„é—®é¢˜. ä¸€ä¸ªlocalå˜é‡ æ”¾åœ¨ä¸€ä¸ªforå¾ªç¯é‡Œé¢,æˆ–è€…æ”¾åœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢ éƒ½å¾ˆå¥½ç†è§£. å› ä¸ºå’Œå…¶ä»–è¯­è¨€éƒ½ç›¸åŒå˜›. å°±æ˜¯å±€éƒ¨å˜é‡çš„æ¦‚å¿µ.</p>
<p>ä½†æ˜¯è¿™ä¸ª<code>require</code>æ˜¯æ€ä¹ˆä¸ªæ„æ€? æˆ‘å½“æ—¶å°±æ˜¯ä»¥ä¸º<code>require</code>å°±æ˜¯æ¨ªå‘æ‹†åˆ†</p>
<p>æ¯”å¦‚æˆ‘å°±ä¸€ä¸ª<code>Main.lua</code></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> A = <span class="string">"A"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"A is: "</span>..A)</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœè‚¯å®šå°±æ˜¯</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">A</span> is: <span class="keyword">A</span></span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶æˆ‘æŠŠ<code>local A = &quot;A&quot;</code>æ”¾åˆ°å¦å¤–ä¸€ä¸ªæ–‡ä»¶<code>ClassA.lua</code>ä¸­ ç„¶åæ‰§è¡Œ</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">require</span><span class="params">(<span class="string">"ClassA"</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">"A is: "</span>..A)</span></span></span><br></pre></td></tr></table></figure>
<p>è¿è¡Œä¼šæŠ¥é”™</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lua: main.lua:<span class="number">4</span>: attempt to concatenate a <span class="literal">nil</span> value (global <span class="string">'A'</span>)</span><br></pre></td></tr></table></figure>
<p>æˆ‘å¤§æ¦‚çœ‹äº†ä¸€ä¸‹<code>require</code>çš„ä¼ªå®ç°ä»£ç ,åº”è¯¥æ˜¯å†…éƒ¨é€šè¿‡ä¸€ä¸ªLoaderè¿›è¡ŒåŠ è½½,ç„¶åç¼“å­˜åˆ°<code>package.loaded</code>ä¸­æ¥.æ‰€ä»¥æ˜¯å¦å¯ä»¥ç†è§£ä¸º</p>
<blockquote>
<p>æ•´ä¸ª<code>require</code>åˆ°çš„â€æ–‡ä»¶â€éƒ½æ˜¯åœ¨è¿™ä¸ªLoadå‡½æ•°çš„ä½œç”¨åŸŸä¸­(closureé—­åŒ…)?</p>
</blockquote>
<p>ä¸è¿‡ æ— è®ºå…·ä½“å®ç°å¦‚ä½• æˆ‘ç›®å‰å°±æŠŠ<code>require</code>å½“åšæ”¾åœ¨äº†ä¸€ä¸ª<code>do end</code>çš„ä»£ç å—ä¸­æ¥ç†è§£äº†</p>
<p>ä¼ªç å¦‚ä¸‹:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--require("ClassA")è½¬æ„ä¸º:</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">local</span> A = <span class="string">"A"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--Main.lua</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"A is: "</span>..A)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="çœ‹æ‡µåœˆçš„è¯­æ³•"><a href="#çœ‹æ‡µåœˆçš„è¯­æ³•" class="headerlink" title="çœ‹æ‡µåœˆçš„è¯­æ³•"></a>çœ‹æ‡µåœˆçš„è¯­æ³•</h2><p>Luaå†…æœ‰ä¸€äº›è¯­æ³•ç³–(Syntactic sugar),è¿˜æœ‰ä¸€äº›å†…ç½®çš„å…³é”®key. æ‰€ä»¥åˆæ¥è§¦æ—¶å€™æ¯”è¾ƒæ™•, è™½ç„¶éƒ½æœ‰æ‰€äº†è§£ ä½†æ˜¯å¼€å§‹æ—¶ç†è§£çš„è¿˜æ˜¯ä¸å¤Ÿæ·±å…¥. å°±åƒä¸Šå­¦æ—¶å€™å­¦ä¹ æ–°å…¬å¼ä¼¼çš„. è®²å®Œéƒ½ä¼š ä¸€æ”¾åˆ°å…·ä½“ä¹ é¢˜é‡Œé¢åˆéƒ½æ‡µåœˆäº†.</p>
<h3 id="function"><a href="#function" class="headerlink" title="function"></a>function</h3><h4 id="function-ä¸­çš„-name"><a href="#function-ä¸­çš„-name" class="headerlink" title="function ä¸­çš„ name"></a>function ä¸­çš„ name</h4><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Fun1=<span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">"Fun1 called"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Fun2</span><span class="params">()</span></span></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">"Fun2 called"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">Fun1();</span><br><span class="line">Fun2();</span><br><span class="line"></span><br><span class="line">Wrap=&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Wrap.WFun1</span><span class="params">()</span></span></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">"Wrap Fun1 called"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">Wrap.WFun2=<span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">"Wrap Fun2 called"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">Wrap[<span class="string">"WFun1"</span>]()</span><br><span class="line">Wrap.WFun2();</span><br></pre></td></tr></table></figure>
<p>Luaä¸­å‡½æ•°å‡ä¸º<strong>åŒ¿åå‡½æ•°</strong>,æ‰€ä»¥Fun2å°±å¯ä»¥ç†è§£ä¸ºåœ¨å…¨å±€å£°æ˜äº†ä¸€ä¸ªå«Fun2çš„å˜é‡,å…¶å¼•ç”¨äº†ä¸€ä¸ªåŒ¿åå‡½æ•°,</p>
<p>åŒç†çš„,<code>Wrap.WFun1</code> å°±æ˜¯åœ¨Wrapè¿™ä¸ª<code>table</code>ä¸­ç”¨ä¸€ä¸ªWFun1ä½œä¸ºä¸€ä¸ªKey å¼•ç”¨äº†ä¸€ä¸ªåŒ¿åå‡½æ•°.</p>
<h4 id="function-ä¸­çš„"><a href="#function-ä¸­çš„" class="headerlink" title="function ä¸­çš„ :"></a>function ä¸­çš„ :</h4><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Wrap=&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Wrap:WFun3</span><span class="params">()</span></span></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">"Self is a "</span>,self);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">Wrap.WFun4=<span class="function"><span class="keyword">function</span><span class="params">(_firstArg)</span></span></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">"First also is a "</span>,_firstArg);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Wrap.WFun3(Wrap)</span><br><span class="line">Wrap:WFun3()</span><br><span class="line"></span><br><span class="line">Wrap.WFun4(Wrap)</span><br><span class="line">Wrap:WFun4(Wrap)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> AnotherWrap = &#123;&#125;</span><br><span class="line">AnotherWrap.HoldKey=Wrap;</span><br><span class="line"></span><br><span class="line">Wrap.WFun3(AnotherWrap)</span><br><span class="line">AnotherWrap.HoldKey:WFun3()</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢å‡½æ•°è°ƒç”¨çš„è¾“å‡ºç»“æœä¸º:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Self is a 	<span class="built_in">table</span>: <span class="number">0x7f8353c068f0</span></span><br><span class="line">Self is a 	<span class="built_in">table</span>: <span class="number">0x7f8353c068f0</span></span><br><span class="line">First also is a <span class="built_in">table</span>: <span class="number">0x7f8353c068f0</span></span><br><span class="line">First also is a <span class="built_in">table</span>: <span class="number">0x7f8353c068f0</span></span><br><span class="line"></span><br><span class="line">Self is a 	<span class="built_in">table</span>: <span class="number">0x7f8353c02690</span></span><br><span class="line">Self is a 	<span class="built_in">table</span>: <span class="number">0x7f8353c068f0</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>:</code> åœ¨å‡½æ•°å®šä¹‰é˜¶æ®µåˆ™è¡¨ç¤ºå‡½æ•°ä¼šæœ‰ä¸€ä¸ªå‚æ•°,ç„¶åå…¶å‚æ•°åç§°ä¸º<strong><code>self</code></strong>.</p>
</li>
<li><p><code>:</code> åœ¨å‡½æ•°è°ƒç”¨é˜¶æ®µåˆ™è¡¨ç¤ºå°†è°ƒç”¨çš„Tableä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥è¯¥å‡½æ•°</p>
</li>
</ul>
<p><strong><code>self</code></strong> å’Œ <strong><code>:</code></strong> çš„æ„ä¹‰ä¹Ÿ<strong>ä»…æ­¤è€Œå·²</strong>,æ‰€ä»¥ç”¨æ—¶å€™ä¸è¦æƒ³å½“ç„¶ å°¤å…¶åœ¨åº•å±‚å·²ç»å°è£…ä¸º<code>ä¼ªç±»</code>ç»“æ„å. æˆ‘æ‡µåœˆæ—¶å€™<code>Google</code>åˆ°çš„å¥½äº›äººæçš„é—®é¢˜ éƒ½æ˜¯å› ä¸ºç›´æ¥ä½¿å¾—ç°æˆæ¶æ„ ç„¶åå¦–é­”åŒ–äº† è¿™ä¸¤ä¸ªå…³é”®å­—â˜¹ï¸</p>
<h4 id="function-ä¸­çš„-â€¦"><a href="#function-ä¸­çš„-â€¦" class="headerlink" title="function ä¸­çš„ â€¦"></a>function ä¸­çš„ â€¦</h4><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Fun1</span><span class="params">( ... )</span></span></span><br><span class="line">	<span class="keyword">local</span> a,b,c = ...</span><br><span class="line">	<span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"Arg a=%s b=%s c=%s"</span>,a,b,c))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">Wrap=&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Wrap.WFun1</span><span class="params">( ... )</span></span></span><br><span class="line">	<span class="keyword">local</span> <span class="built_in">arg</span> = <span class="built_in">table</span>.pack(...)</span><br><span class="line">	<span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">pairs</span>(<span class="built_in">arg</span>) <span class="keyword">do</span></span><br><span class="line">		<span class="built_in">print</span>(k,v)</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">Fun1(<span class="string">"A"</span>,<span class="string">"B"</span>,<span class="string">"C"</span>,<span class="string">"D"</span>)</span><br><span class="line">Wrap.WFun1(<span class="string">"A"</span>,<span class="string">"B"</span>,<span class="string">"C"</span>,<span class="string">"D"</span>)</span><br><span class="line">Wrap:WFun1(<span class="string">"A"</span>,<span class="string">"B"</span>,<span class="string">"C"</span>,<span class="string">"D"</span>)</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœä¸º:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Arg a=A b=B c=C</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>	A</span><br><span class="line"><span class="number">2</span>	B</span><br><span class="line"><span class="number">3</span>	C</span><br><span class="line"><span class="number">4</span>	D</span><br><span class="line">n	<span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>	<span class="built_in">table</span>: <span class="number">0x7fab78406320</span></span><br><span class="line"><span class="number">2</span>	A</span><br><span class="line"><span class="number">3</span>	B</span><br><span class="line"><span class="number">4</span>	C</span><br><span class="line"><span class="number">5</span>	D</span><br><span class="line">n	<span class="number">5</span></span><br></pre></td></tr></table></figure>
<p><code>...</code>å°±æ˜¯å¯å˜å‚æ•°,å¿…é¡»ç”¨åˆ°å‡½æ•°å°¾éƒ¨çš„å£°æ˜ è¿™ä¸ªå†™åŒ¿åå‡½æ•°æ—¶å€™ä¸€èˆ¬éƒ½ä¼šæ¥è§¦åˆ°,åªä¸è¿‡æˆ‘æ¥è§¦çš„è¯­è¨€æœ‰äº›ä¼šè®©ä½ å£°æ˜æ—¶å€™æŒ‡å®šä¸ªåå­— æ¯”å¦‚<code>...yourArgName</code>,ç„¶åç›´æ¥å‡½æ•°å†…ä½¿ç”¨è¯¥åå­—å°±è¡Œäº†,Luaæ˜¯ç›´æ¥ç”¨<code>...</code> å°±ä½œä¸ºåå­—äº†.</p>
<p>å¯ä»¥ç›´æ¥<code>local a,b,c = ...</code> è¿™æ ·æŠŠæ‰€æœ‰å‚æ•°å–åˆ°, ä¹Ÿå¯ä»¥ç”¨<code>table.pack</code>ç»„è£…æˆä¸€ä¸ª<code>table</code>(Lua5.2+),æˆ–è€…ç›´æ¥<code>{...}</code>è£…è¿›ä¸€ä¸ªåŒ¿åçš„<code>table</code>ä¸­. </p>
<p><code>æ•™ç§‘ä¹¦ç¬¬å››ç‰ˆ p62 é¡µ</code> è¯´çš„å¾ˆæ¸…æ¥šäº†,å°±ä¸é‡å¤äº†</p>
<h4 id="function-ä¸­çš„-1"><a href="#function-ä¸­çš„-1" class="headerlink" title="function ä¸­çš„ {}"></a>function ä¸­çš„ {}</h4><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Fun1</span><span class="params">(_arg)</span></span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(_arg) <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">print</span>(k, v)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">Fun1(&#123;x = <span class="number">10</span>, y = <span class="number">15</span>, w = <span class="number">1280</span>, h = <span class="number">720</span>, title = <span class="string">"Hello"</span>&#125;)</span><br><span class="line"></span><br><span class="line">Fun1&#123;</span><br><span class="line">    title = <span class="string">"Hello2"</span>,</span><br><span class="line">    x = <span class="number">10</span>,</span><br><span class="line">    y = <span class="number">15</span>,</span><br><span class="line">    w = <span class="number">1280</span>,</span><br><span class="line">    h = <span class="number">720</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“å‡½æ•°åªæ¥æ”¶ä¸€ä¸ªå‚æ•°,ä¸”è¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªtableæ—¶å€™ <code>Fun1({})</code>å¯ä»¥ç®€å†™æˆ Fun1{} </p>
<h3 id="metatable"><a href="#metatable" class="headerlink" title="metatable"></a>metatable</h3><p>metatable aka å…ƒè¡¨ ç®—æ˜¯Luaçš„çµé­‚äº†å§?ğŸ˜“ ,è¿™å—å…¶å®åªèƒ½å¤šçœ‹ çœ‹å„ç§äººå†™çš„ ä»å¤šè§’åº¦å»ç†è§£ æˆ‘è§‰å¾—æ˜¯æœ€å¿«ä¸Šæ‰‹æ¸ é“.</p>
<p>é‡å¤åˆ¶è½®å­æ— æ„ä¹‰,æˆ‘å°±è¯´ä¸‹æˆ‘ä¸ªäººå¯¹å…¶çš„ç†è§£å§</p>
<p>é¦–å…ˆæŠ›å¼ƒæ‰€æœ‰OOPæ€æƒ³,ä¸è¦æƒ³é‚£å † å°±å½“è‡ªå·±åˆšå­¦ç¼–ç¨‹. é¢å‘å¯¹è±¡æ˜¯ä»€ä¹ˆ? å®Œå…¨ä¸çŸ¥é“å‘¢.</p>
<p>å°†æ‰€æœ‰çš„tableéƒ½ç†è§£ä¸ºä¸€å¼ A4ç™½çº¸,æ©,å°±æ˜¯å¤å°ç”¨çš„é‚£ä¸ª! æ™®é€štableæ˜¯ä¸€å¼ ,metatableæ˜¯å¦å¤–ä¸€å¼ </p>
<p>åŒºåˆ†å¥½ <code>metatable</code>,<code>setmetatable</code>:</p>
<ul>
<li><code>metatable</code> : å°±æ˜¯ä¸€ä¸ªtableè¡¨, ä¹Ÿå°±æ˜¯ä¸€å¼ æ™®é€šçš„ A4ç™½çº¸</li>
</ul>
<ul>
<li><code>setmetatable</code> : è¿™æ˜¯ä¸€ä¸ªå‡½æ•°</li>
</ul>
<blockquote>
<p><code>setmetatable(ç™½çº¸1å·,ç™½çº¸1å·_Mt)</code> è¿™ä¸ªå°±ç¿»è¯‘ä¸º <code>ç™½çº¸1å·</code> ä½ å¤§å“¥æ˜¯ <code>ç™½çº¸1å·_Mt</code> é‚£å¼ æ™®é€šç™½çº¸. å½“ä½ æœ‰ä»€ä¹ˆä¸æ‡‚çš„æ—¶å€™ éƒ½é—®ä»–!</p>
<p>æ¯”å¦‚:</p>
<p>ä½ è¯´ ç™½çº¸1å·(PaperOne) ä½ å’Œ ç™½çº¸2å·(PaperTwo) åŠ åŠ çœ‹ æˆ‘çœ‹çœ‹èƒ½å¼„å‡ºä¸ªå•¥å‡ºæ¥! ç¿»è¯‘ä¸ºæœºå™¨ç å°±æ˜¯</p>
</blockquote>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PaperOne=&#123;&#125;</span><br><span class="line">PaperOne_Mt=&#123;&#125;</span><br><span class="line"><span class="built_in">setmetatable</span>(PaperOne,PaperOne_Mt)</span><br><span class="line"></span><br><span class="line">PaperTwo=&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> result = PaperOne+PaperTwo</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™ <code>ç™½çº¸1å·</code>å°±ä¸çŸ¥é“è¿™ä¸ªtable+tableæ˜¯åº”è¯¥æ€ä¹ˆæ•´äº†,å°±é—®<code>ç™½çº¸1å·_Mt</code>,å¤§å“¥è¿™ä¸ª<code>table</code>+<code>table</code>æ€ä¹ˆæ? </p>
<p>è¿™ä¹Ÿå°±æ˜¯å…ƒè¡¨çš„ <code>ç®—æ•°è¿ç®—</code>åŠ<code>å…³ç³»è¿ç®—</code>çš„ä½œç”¨. ç›¸å…³è¯¦ç»†å®ç°è¯·çœ‹ æ•™ç§‘ä¹¦ğŸ˜‘</p>
<h4 id="index-å’Œ-newindex"><a href="#index-å’Œ-newindex" class="headerlink" title="index å’Œ newindex"></a><strong>index å’Œ </strong>newindex</h4><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">RedPaperOne = &#123;&#125;</span><br><span class="line">RedPaperTwo = &#123;&#125;</span><br><span class="line">RedPaperTwo.Name = <span class="string">"PaperTow"</span></span><br><span class="line"></span><br><span class="line">RedPaper_Mt = &#123;&#125;</span><br><span class="line"><span class="built_in">setmetatable</span>(RedPaperOne, RedPaper_Mt)</span><br><span class="line"><span class="built_in">setmetatable</span>(RedPaperTwo, RedPaper_Mt)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">RedPaper_Mt.__index</span><span class="params">(_table, _key)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"çº¢çº¸å¤§å“¥è¯´ : ä½ "</span>, _table, <span class="string">"æ²¡æœ‰è¿™ä¸ªKey"</span>, _key, <span class="string">"ç»™ä½ ä¸ªé»˜è®¤å€¼ 66666 å¥½äº†"</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"66666"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"RedPaperOne æˆ‘çš„åå­—æ˜¯: "</span>, RedPaperOne.Name)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"RedPaperTwo æˆ‘çš„åå­—æ˜¯: "</span>, RedPaperTwo.Name)</span><br><span class="line"></span><br><span class="line">GreenPaperOne = &#123;&#125;</span><br><span class="line">GreenPaperTwo = &#123;&#125;</span><br><span class="line">GreenPaperTwo.Name = <span class="string">"ç»¿2å·"</span></span><br><span class="line"></span><br><span class="line">GreenPaper_Mt = &#123;&#125;</span><br><span class="line">GreenPaper_Mt.Name = <span class="string">"å°ç»¿"</span></span><br><span class="line">GreenPaper_Mt.<span class="built_in">__index</span> = GreenPaper_Mt</span><br><span class="line"></span><br><span class="line"><span class="built_in">setmetatable</span>(GreenPaperOne, GreenPaper_Mt)</span><br><span class="line"><span class="built_in">setmetatable</span>(GreenPaperTwo, GreenPaper_Mt)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"GreenPaperOne æˆ‘çš„åå­—æ˜¯: "</span>, GreenPaperOne.Name)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"GreenPaperTwo æˆ‘çš„åå­—æ˜¯: "</span>, GreenPaperTwo.Name)</span><br><span class="line"></span><br><span class="line">BluePaperOne = &#123;&#125;</span><br><span class="line">BluePaper_Mt = &#123;&#125;</span><br><span class="line">BluePaper_Mt.<span class="built_in">__newindex</span> = <span class="function"><span class="keyword">function</span> <span class="params">(_table, _key, _value)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"è“çº¸å¤§å“¥è¯´: ä½ å°±æ˜¯å°è“ åˆ«é—¹"</span>)</span><br><span class="line">    <span class="built_in">rawset</span>(_table, _key, <span class="string">"å°è“"</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">setmetatable</span>(BluePaperOne, BluePaper_Mt)</span><br><span class="line"></span><br><span class="line">BluePaperOne.Name = <span class="string">"æˆ‘æ˜¯å°ç»¿"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"BluePaperOne æˆ‘çš„åå­—æ˜¯: "</span>, BluePaperOne.Name)</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœ:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">çº¢çº¸å¤§å“¥è¯´ : ä½ 	<span class="built_in">table</span>: <span class="number">0x7fa05a406930</span> æ²¡æœ‰è¿™ä¸ªKey Name ç»™ä½ ä¸ªé»˜è®¤å€¼ <span class="number">66666</span> å¥½äº†</span><br><span class="line"></span><br><span class="line">RedPaperOne æˆ‘çš„åå­—æ˜¯: <span class="number">66666</span></span><br><span class="line">RedPaperTwo æˆ‘çš„åå­—æ˜¯: PaperTow</span><br><span class="line"></span><br><span class="line">GreenPaperOne æˆ‘çš„åå­—æ˜¯: å°ç»¿</span><br><span class="line">GreenPaperTwo æˆ‘çš„åå­—æ˜¯: ç»¿<span class="number">2</span>å·</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è“çº¸å¤§å“¥è¯´: ä½ å°±æ˜¯å°è“ åˆ«é—¹</span><br><span class="line">BluePaperOne æˆ‘çš„åå­—æ˜¯: å°è“</span><br></pre></td></tr></table></figure>
<p><code>__index</code>å’Œ <code>__newindex</code> éƒ½æ˜¯ <code>å¤§å“¥</code>èº«ä¸Šä¸¤ä¸ªç‰¹æœ‰çš„å±æ€§,ä¸€ä¸ªè´Ÿè´£<code>å°å¼Ÿ</code>èº«ä¸Šæ²¡æœ‰è¿™ä¸ªå±æ€§æ—¶å€™å»get,å¦ä¸€ä¸ªè´Ÿè´£å»set</p>
<p>å½“<code>å°å¼Ÿ</code>èº«ä¸Šæœ‰è¿™ä¸ªå±æ€§äº†,å°å¼Ÿæ˜¯æ ¹æœ¬éƒ½ä¸ä¼šé¸Ÿå¤§å“¥çš„,è‡ªå·±å°±å¤„ç†æ‰äº†.</p>
<p>æœ‰äº›æ—¶å€™<code>å¤§å“¥</code>ä¼šæŠŠè¿™ä¸¤ä¸ª<code>key</code>å®šä¹‰ä¸ºä¸¤ä¸ªå‡½æ•°,å¤§å“¥è‡ªå·±çœŸåšç‚¹äº‹å„¿. ä½†æœ‰çš„æ—¶å€™å¤§å“¥å°±æ‡’,ç›´æ¥å°± <code>å¤§å“¥.__index=å¤§å“¥</code></p>
<p>æ­¤æ—¶å°å¼Ÿå½“å¤„ç†ä¸äº†æ—¶å€™é—®å¤§å“¥:  å¤§å“¥,é‚£å“¥ä»¬å„¿è¦è¾“å‡ºæˆ‘èº«ä¸Šçš„<code>Name</code>å±æ€§,æˆ‘æ²¡é‚£ç©æ„å„¿å•Š,å¤§å“¥é—­ç€çœ¼ç‘ æŒ‡äº†æŒ‡è‡ªå·±èº«ä¸Šçš„<code>Name=å°ç»¿</code>é‚£æ¡è®°å½•. å°å¼Ÿå°±å¿ƒé¢†ç¥ä¼šçš„æŠŠâ€å°ç»¿â€ è¿”å›äº†.</p>
<p>ä»¥ä¸Šè®¾ç½®äº†ä¸€ä¸ªå¾ˆ2Bçš„æƒ…æ™¯,ä½†æ˜¯æœ‰äº›æ—¶å€™ ç¢°åˆ°ä¸€äº›ä¸æ˜¯å¾ˆå®¹æ˜“çœ‹æ‡‚çš„ä»£ç  ä½ å¯ä»¥æ˜¯è¿™æŠŠé‚£æ®µä»£ç å¸¦å…¥ æƒ…æ™¯,æ²¡å‡†ä¼šæ›´å®¹æ˜“å¸®ä½ ç†è§£.</p>
<p>æœ‰ä¸ªè¡¥å……å°±æ˜¯<code>__newindex</code>å†…éƒ¨å®ç°ä½¿ç”¨äº†<code>rawset</code>,å°±æ˜¯è®©å°å¼Ÿå¿½ç•¥<code>__newindex</code>å®ç°,è¿›è¡Œç›´æ¥èµ‹å€¼,å¦‚æœä¸è¿™ä¹ˆå†™å°±å˜æˆè‡ªå·±è°ƒè‡ªå·±,ç„¶åæ— é™å¾ªç¯ä¸‹å»äº†.</p>
<h4 id="ç•™æ„-setmetatable-x-index-y"><a href="#ç•™æ„-setmetatable-x-index-y" class="headerlink" title="ç•™æ„ setmetatable(x,{__index=y})"></a>ç•™æ„ setmetatable(x,{__index=y})</h4><p><code>setmetatable(x,{__index=y})</code> è¿™è¡Œä»£ç å…¶å®æœ‰ä¸ªå‘,åˆšå¼€å§‹è¢«ç»•è¿›å»äº†. å°±æ˜¯è¿™é‡Œé¢å…¶å®æ˜¯æœ‰3å¼ è¡¨çš„,å°±æ˜¯ä¸‰ä¸ªç™½çº¸. è¿˜æ˜¯å¥—ç”¨ä¸Šé¢çš„ä¾‹å­ ä¸€ä¸ªæ˜¯<code>ç™½çº¸1å·</code>,å¦ä¸€ä¸ªæ˜¯<code>ç™½çº¸ä¸€å·_Mt</code>. ä½†æ˜¯é‡Œé¢è¿˜æœ‰ä¸€ä¸ªåŒ¿å<code>table</code>å°±æ˜¯{__index=y}</p>
<p>ç¿»è¯‘ä¸º2Bæƒ…æ™¯å°±æ˜¯</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">PaperOne=&#123;&#125;</span><br><span class="line">PaperOne_Fake_Brother=&#123;&#125;</span><br><span class="line">PaperOne_Fake_Brother.Name=<span class="string">"æˆ‘æ˜¯ä½ å‡å¤§å“¥"</span></span><br><span class="line"></span><br><span class="line">PaperReal_Brother=&#123;&#125;</span><br><span class="line">PaperReal_Brother.Name=<span class="string">"æˆ‘æ˜¯ä½ çœŸå¤§å“¥"</span></span><br><span class="line">PaperReal_Brother.<span class="built_in">__index</span>=PaperOne_Fake_Brother</span><br><span class="line"></span><br><span class="line"><span class="built_in">setmetatable</span>(PaperOne,PaperReal_Brother)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(PaperOne.Name)</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœ:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘æ˜¯ä½ å‡å¤§å“¥</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/fb1d9ef0-ae96-11e8-bce8-210b733613c3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="éš”å£è€ç‹">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="éš”å£è€ç‹">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/fb1d9ef0-ae96-11e8-bce8-210b733613c3/" itemprop="url">Luaä»å…¥é—¨åˆ°å…¥äº†é—¨(1) æ­å»ºå­¦ä¹ ç¯å¢ƒ</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-09-02T18:00:01+08:00">
                2018-09-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ç¼–ç¨‹/" itemprop="url" rel="index">
                    <span itemprop="name">ç¼–ç¨‹</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><h3 id="å†ç¨‹"><a href="#å†ç¨‹" class="headerlink" title="å†ç¨‹"></a>å†ç¨‹</h3><p>æœ€è¿‘éœ€è¦ç»™æ¸¸æˆåŠ å…¥ä»»åŠ¡ç³»ç»Ÿ,æƒ³ç€ç”¨è„šæœ¬æ¥å†™,æ–¹ä¾¿ä»¥åæ‰©å±•. æ‰€ä»¥å¤§æ¦‚èŠ±äº†ä¸€å‘¨çš„æ—¶é—´æŠ˜è…¾äº†ä¸€ä¸‹è¿™å—.</p>
<p>ç›®å‰ä¸–é¢ä¸»æµçš„UnityåµŒå…¥è„šæœ¬åº”è¯¥æ˜¯ä¸¤å¤§é˜µè¥</p>
<p>C#çš„ <a href="http://ourpalm.github.io/ILRuntime/public/v1/guide/index.html" target="_blank" rel="noopener">ILRuntime(æŒè¶£)</a></p>
<p>Luaçš„ *Lua(SLua,ToLua,XLua(è…¾è®¯))</p>
<p>æœ€å¼€å§‹æˆ‘æ˜¯æƒ³é€‰æ‹©ILRuntimeçš„,ä¸è¿‡æŠ˜è…¾äº†ä¸€å¤§åœˆæœ€ç»ˆè¿˜æ˜¯è§‰å¾—ç”¨Luaæ¥åšæ¯”è¾ƒå¥½. ç›®å‰æ¥çœ‹æˆ‘è§‰å¾—è¿™ä¸ªå†³å®šè¿˜æ˜¯æŒºæ˜æ™ºçš„.</p>
<h3 id="ä¸ºä½•å†™æ•™ç¨‹"><a href="#ä¸ºä½•å†™æ•™ç¨‹" class="headerlink" title="ä¸ºä½•å†™æ•™ç¨‹"></a>ä¸ºä½•å†™æ•™ç¨‹</h3><p>æˆ‘å‘ç°å¯¹äºæ–°çŸ¥è¯†ä¼šå‡ºç°ä¸¤ç§æƒ…å†µ</p>
<p>å¯¹äºæŸäº›æœ‰çŸ­æœŸæ—¶æ•ˆæ€§çš„ å½“æ—¶ä¼šçœ‹çš„å¾ˆæ˜ç™½å¾ˆé€å½» ä½†æ˜¯æŠŠç›¸åº”é—®é¢˜è§£å†³å®Œå<br>è¿‡ä¸€é˜µå­å†çœ‹ å‘ç°åˆå¿˜è®°äº†å¾ˆå¤š. æ¯”å¦‚æˆ‘ä¸æ­¢ä¸€æ¬¡çœ‹è¿‡çŸ©é˜µ,å‘é‡.ä½†æ˜¯å¾€å¾€ç­‰æŠŠç›¸å…³æ•°å­¦é—®é¢˜è§£å†³äº†,å‡ å¤©åå›å¤´å†çœ‹ å‘ç°é‚£å¨ä¸œè¥¿å·²ç»å¿˜çš„å·®ä¸å¤šäº†â€¦ç”¨çš„æ—¶å€™åˆè¦é‡æ–°æ‹¾èµ·æ¥. </p>
<p>è¿˜æœ‰ä¸€äº›ä¼šä¸€ç›´é•¿æ—¶é—´ä½¿ç”¨çš„çŸ¥è¯†,åº¦è¿‡äº†é—¨æ§›æœŸåä¼šå˜æˆç±»ä¼¼äºä¸€ç§æœ¬èƒ½. å½“æ—¶é‚£ç§å›°æƒ‘,é‚£ç§ç™¾æ€ä¸å¾—å…¶è§£ å›å¤´æ¥çœ‹ ä¼šè§‰å¾—å¾ˆå¹¼ç¨š. ä¸çŸ¥é“ä¸ºä½•é‚£ä¹ˆç®€å•çš„ä¸€ä¸ªé—®é¢˜ä¼šå¡é‚£ä¹ˆä¹…. </p>
<p>Luaæ–¹é¢çš„çŸ¥è¯† æˆ‘è§‰å¾—ä¼šæ˜¯åè€…. å°±ç®—ç°åœ¨åŠ¨ç¬”å¼€å§‹å†™æ•™ç¨‹æ—¶å€™ çœ‹ç€è¦å†™çš„å¤§çº² éƒ½ä¼šæœ‰ä¸€ç§ è¿™ä¹ˆç®€å• è¿˜æœ‰å¿…è¦å†™ä¹ˆ çš„æ„Ÿè§‰. æ­¤æ—¶å·²ç»å¿«å¿˜è®°äº† æœ€åˆ æ‹¿ç€æ•™ç¨‹ ä¸€ä¸ªç« èŠ‚æ¥å›æ¥å»è¯»äº†å¥½å‡ éçš„æ ·å­,å¿˜è®°äº†åˆçœ‹åˆ°é£ç¥å†™çš„classå®šä¹‰æ—¶å€™æ˜¯æœ‰å¤šæ‡µåœˆ..</p>
<p>ä¸è¿‡ ä¸è®ºæ˜¯å“ªç§â€çŸ¥è¯†â€ æˆ‘è§‰å¾—å†™ä¸‹æ¥éƒ½æ˜¯æœ‰å¿…è¦çš„. ä¸€ä¸ªæ˜¯ç»™è‡ªå·±å†™ä¸ªå¤‡å¿˜ æ–¹ä¾¿ä»¥åç”¨æ—¶å€™ç¿»æŸ¥,å¦ä¸€ä¸ªæ˜¯ç”¨å†™ä½œçš„æ–¹å¼ å†æ¶ˆåŒ–ä¸€éç›¸å…³çŸ¥è¯†. æŸ¥æ¼è¡¥ç¼º åŠ é€Ÿè¿™ç§æœ¬èƒ½çš„è®°å¿†. å¹¶ä¸”å¤–ä¸€æœ‰äººæœåˆ° ä»ä¸­è·ç›Šäº†å‘¢, è¿™ä¹Ÿæ˜¯è¯´ä¸å‡†çš„äº‹å„¿å˜›ğŸ˜ƒ</p>
<p>OK çµ®å¨åˆ°æ­¤ç»“æŸ,å¼€å§‹æ­£é¢˜ ğŸ˜ƒ</p>
<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>æˆ‘æ˜¯Mac,æ‰€ä»¥ç¯å¢ƒéƒ½æ˜¯ä»¥Macè¯´çš„. æ© Macç”¨ä¹…äº† è§‰å¾—WindowsçœŸæ˜¯â€¦â€¦  </p>
<p>æ© è¿˜æ˜¯è¯´Luaå§.</p>
<h2 id="å®‰è£…Lua"><a href="#å®‰è£…Lua" class="headerlink" title="å®‰è£…Lua"></a>å®‰è£…Lua</h2><p>ç›´æ¥<a href="https://www.lua.org/download.html" target="_blank" rel="noopener">å®˜ç½‘ä¸‹è½½æœ€æ–°çš„taråŒ…</a>,è§£å‹åˆ°ä»»æ„ä½ç½® å‘½ä»¤è¡Œcdè¿›å»åæ‰§è¡Œ:</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">make</span> macosx test</span><br><span class="line"><span class="built_in">make</span> install</span><br></pre></td></tr></table></figure>
<p>ä¸€åˆ‡OKå å‘½ä»¤è¡Œæ‰§è¡Œ<code>lua</code>ä¼šçœ‹åˆ°</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Lua <span class="number">5.3</span><span class="number">.5</span>  Copyright (C) <span class="number">1994</span><span class="number">-2018</span> Lua.org, PUC-Rio</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p>æ© è¿™è¯´æ˜Luaå·²ç»å®‰è£…å¥½äº†.</p>
<p>è™½ç„¶æœ€ç»ˆç”Ÿäº§ç¯å¢ƒæ˜¯ç›´æ¥æ˜¯Unityå†…åµŒ å¹¶ä¸éœ€è¦æœ¬åœ°å®‰è£…Lua,ä½†æ˜¯å¯¹äºå­¦ä¹ ç¯å¢ƒæ¥è¯´. æœ¬æœºä¸­ç›´æ¥å®‰è£…Lua ä¼šæ–¹ä¾¿è®¸å¤š.</p>
<h2 id="è®¾ç½®Sublime"><a href="#è®¾ç½®Sublime" class="headerlink" title="è®¾ç½®Sublime"></a>è®¾ç½®Sublime</h2><p>æˆ‘æ˜¯æ¯”è¾ƒå»ºè®® å­¦ä¹ ç¯å¢ƒç›´æ¥ç”¨ sublimeç¼–å†™å°±å¯ä»¥äº†,å¾ˆæ–¹ä¾¿. ä¸è¿‡ä¹‹å‰ä¹Ÿèµ°è¿‡å¼¯è·¯ æŠ˜è…¾äº†å¥½å¤šIDE ZeroBrane,Idea ç­‰ç­‰ éƒ½æœ‰å°è¯•è¿‡. ä¸è¿‡åæ¥å‘ç°éƒ½æ˜¯ çè€½è¯¯åŠŸå¤«, æ€»æƒ³æ‰¾ä¸ª å†™èµ·æ¥å­—å·çœ‹ç€èˆ’æœçš„ èƒ½æ ¼å¼åŒ–ä»£ç çš„ åˆæœ‰ä»£ç æç¤ºçš„ è¿˜èƒ½ä¸‹æ–­ç‚¹Watchçš„.  æ© æƒ³å¤šäº†ğŸ˜‚</p>
<h3 id="ä¸‹è½½æ’ä»¶"><a href="#ä¸‹è½½æ’ä»¶" class="headerlink" title="ä¸‹è½½æ’ä»¶"></a>ä¸‹è½½æ’ä»¶</h3><p>Sublime å…¶å®ä¸ä¸‹è½½ä»»ä½•æ’ä»¶å°±å¯ä»¥ç›´æ¥ç”¨çš„,å¹¶ä¸”æ˜¯å†…åµŒBuildç¯å¢ƒçš„</p>
<blockquote>
<p>æ–°å»ºä¸€ä¸ª<code>hello.lua</code>è¿›å»å†™ä¸€è¡Œ<code>print(&quot;Hello World&quot;)</code> ç„¶åç›´æ¥<code>cmd+b</code> åº•éƒ¨å°±ä¼šç›´æ¥çœ‹ç»“æœ.</p>
</blockquote>
<p>æˆ‘å®‰è£…çš„æ˜¯ä¸¤ä¸ªæ’ä»¶</p>
<ul>
<li><p>LuaFormat : å›½äººå†™çš„ å¯ä»¥æ ¼å¼åŒ–luaä»£ç  å¾ˆæ–¹ä¾¿</p>
</li>
<li><p>SublimeLinter: éœ€è¦å®‰è£…ä¸‰ä¸ª<code>SublimeLinter</code>,<code>SublimeLinter-lua</code>,<code>SublimeLinter-luacheck</code> ç”¨äºå¯¹ä»£ç è¿›è¡Œæ£€æŸ¥,å¹¶ä¸”æŠ¥<code>Error</code>åæ›´å¿«é€Ÿå®šä½é”™è¯¯ä½ç½®</p>
</li>
</ul>
<p>ä¸è¿‡ç°åœ¨å®‰æ’ä»¶éƒ½éœ€è¦ç§‘å­¦ä¸Šç½‘äº†,ç›¸å…³çš„è®¾ç½®å¯ä»¥çœ‹<a href="http://oldking.wang/248f6fe0-adeb-11e8-b21f-6b22e33454a2/" target="_blank" rel="noopener">æˆ‘ä¹‹å‰å†™çš„æ–‡ç« </a></p>
<h3 id="è°ƒæ•´Sidebaræ–‡æœ¬å¤§å°"><a href="#è°ƒæ•´Sidebaræ–‡æœ¬å¤§å°" class="headerlink" title="è°ƒæ•´Sidebaræ–‡æœ¬å¤§å°"></a>è°ƒæ•´Sidebaræ–‡æœ¬å¤§å°</h3><p>è¿™ä¸ªå…¶å®æ˜¯æˆ‘ä¸ªäººé—®é¢˜,å› ä¸ºæ¢äº†ä¸€ä¸ª4Kçš„å¸¦é±¼å±Sublimeçš„Sidebarä¸­çš„æ–‡å­—çœ‹ç€å·¨å°.æ‰€ä»¥éœ€è¦è®¾ç½®ä¸€ä¸‹. å…·ä½“è®¾ç½®æ–¹æ³•æ˜¯:</p>
<p><code>Sublime-&gt;Perferences-&gt;Browse Packages...</code></p>
<p>ç„¶ååœ¨<code>User</code>ç›®å½•ä¸‹å»ºç«‹æ–‡ä»¶<code>Default.sublime-theme</code>,å†…å®¹å¦‚ä¸‹:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"class"</span>: <span class="string">"sidebar_label"</span>,</span><br><span class="line">        <span class="attr">"font.size"</span>: <span class="number">22</span></span><br><span class="line">    &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">        <span class="attr">"class"</span>: <span class="string">"sidebar_tree"</span>,</span><br><span class="line">        <span class="attr">"row_padding"</span>: [<span class="number">8</span>, <span class="number">8</span>],</span><br><span class="line">        <span class="attr">"indent"</span>: <span class="number">12</span>,</span><br><span class="line">        <span class="attr">"indent_offset"</span>: <span class="number">17</span>,</span><br><span class="line">        <span class="attr">"indent_top_level"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"layer0.tint"</span>: [<span class="number">230</span>, <span class="number">230</span>, <span class="number">230</span>],</span><br><span class="line">        <span class="attr">"layer0.opacity"</span>: <span class="number">1.0</span>,</span><br><span class="line">        <span class="attr">"dark_content"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><img src="/media/15359020871991.jpg" alt=""></p>
<h2 id="æœ€ç»ˆæ•ˆæœ"><a href="#æœ€ç»ˆæ•ˆæœ" class="headerlink" title="æœ€ç»ˆæ•ˆæœ"></a>æœ€ç»ˆæ•ˆæœ</h2><p>åœ¨ä»»æ„ä½ç½®æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹,æ¯”å¦‚å«<code>Lua</code>,ç„¶ååœ¨å…¶ä¸‹æ–°å»ºä¸€ä¸ª<code>mian.lua</code>,åŠ å…¥ä¸€è¡Œ<code>print(&quot;Hello World&quot;)</code>. </p>
<p>å°†<code>Lua</code>æ–‡ä»¶å¤¹æ•´ä½“æ‹–å…¥åˆ°<code>Sublime</code>ä¸­æ¥,æ­¤æ—¶å·¦ä¾§<code>Side Bar</code>ä¼šæ˜¾ç¤º,å•å‡»<code>main.lua</code>,ç„¶å<code>cmd+b</code>ç›´æ¥ç¼–è¯‘è¿è¡Œå³å¯.</p>
<p><img src="/media/15359024627409.jpg" alt=""></p>
<h2 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h2><h3 id="å…¥é—¨1å°æ—¶"><a href="#å…¥é—¨1å°æ—¶" class="headerlink" title="å…¥é—¨1å°æ—¶"></a>å…¥é—¨1å°æ—¶</h3><p>å’Œæˆ‘ä¸€æ ·çš„Luaçº¯ç™½æˆ‘å»ºè®®å…ˆçœ‹<a href="https://youtu.be/iMacxZQMPXs" target="_blank" rel="noopener">Y2Bä¸Šé¢çš„è¿™ä¸ªè§†é¢‘</a>, ä¸€ä¸ªå°æ—¶ä»0å¼€å§‹ æ•´ä½“ç»™è¿‡äº†ä¸€éå¦‚ä½•å†™Lua. ä½œä¸ºåˆæ­¥äº†è§£ ä¼šæ¯”çœ‹ä¹¦è¦å¿«å¾ˆå¤š.</p>
<h3 id="æ•™ç§‘ä¹¦"><a href="#æ•™ç§‘ä¹¦" class="headerlink" title="æ•™ç§‘ä¹¦"></a>æ•™ç§‘ä¹¦</h3><p>æˆ‘æœ€è¿‘å°±ä¹°è¿‡ä¸¤æœ¬ä¹¦ ä¸€æœ¬æ˜¯Unity Shaderçš„ å¦å¤–ä¸€æœ¬å°±æ˜¯ è¿™ä¸ª <a href="https://item.jd.com/12384305.html" target="_blank" rel="noopener">Luaç¨‹åºè®¾è®¡ ç¬¬å››ç‰ˆ</a>, å…¶å®æˆ‘æœ€å¼€å§‹æ˜¯çœ‹ç½‘ä¸ŠPDFç‰ˆçš„ ä¸è¿‡ç›®å‰èƒ½æ‰¾åˆ°çš„ åªæœ‰ <code>ç¬¬äºŒç‰ˆ</code>å’Œç¬¬å››ç‰ˆçš„è‹±æ–‡ç‰ˆ.</p>
<p>å»ºè®®è¿˜æ˜¯çœ‹ç¬¬å››ç‰ˆ,å› ä¸ºç¬¬å››å’Œç¬¬äºŒä¹‹é—´é—´éš”äº†å¾ˆä¹…,å¥½å¤šä¸œè¥¿éƒ½æ”¹äº†. æ¯”å¦‚<code>module()</code>è¿™ä¸ªå› ä¸ºè¿‡åº¦è®¾è®¡ æ–°ç‰ˆå·²ç»éƒ½åºŸå¼ƒæ‰äº† ç›´æ¥ç”¨<code>_ENV</code>å³å¯.</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>çœ‹å®Œè§†é¢‘æ’¸å®Œä¹¦ ä¸‹ä¸€æ­¥è¦è§£å†³çš„å°±æ˜¯ æ€ä¹ˆå¼€å§‹æ­£å¼å†™ä»£ç .</p>
<p>ç†æƒ³ä¸­çš„Codingç¯å¢ƒå°±æ˜¯ å†™ä¸ªå…¥å£æ–‡ä»¶ <code>main.lua</code> ç„¶åæ¯ä¸ªç±»ä¸€ä¸ªæ–‡ä»¶ ä»å…¥å£æ–‡ä»¶çš„æŸä¸ªå‡½æ•°å¼€å§‹æ‰§è¡Œ ç„¶åæŠŠæ•´ä¸ªç¨‹åºRunèµ·æ¥.</p>
<p>è¿™ä¹Ÿå°±æ˜¯æˆ‘åç»­æ•™ç¨‹ä¼šCoverçš„éƒ¨åˆ†.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/248f6fe0-adeb-11e8-b21f-6b22e33454a2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="éš”å£è€ç‹">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="éš”å£è€ç‹">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/248f6fe0-adeb-11e8-b21f-6b22e33454a2/" itemprop="url">Sublimeä½¿ç”¨ä»£ç†æ›´æ–°PackageControl</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-09-01T21:30:07+08:00">
                2018-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/å…¶ä»–/" itemprop="url" rel="index">
                    <span itemprop="name">å…¶ä»–</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="è¢«å¢™"><a href="#è¢«å¢™" class="headerlink" title="è¢«å¢™"></a>è¢«å¢™</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Package Control</span><br><span class="line"></span><br><span class="line">There are <span class="keyword">no</span> packages available <span class="keyword">for</span> installation</span><br><span class="line"></span><br><span class="line">Please see http<span class="variable">s:</span>//packagecontrol.io/docs/troubleshooting <span class="keyword">for</span> <span class="keyword">help</span></span><br></pre></td></tr></table></figure>
<p>æ© è¿™å¹´å¤´ ä¸ä¼šç‚¹<code>ç§‘å­¦ä¸Šç½‘</code>è¿ä¸ªSublimeæ’ä»¶éƒ½æ›´æ–°ä¸ä¸‹æ¥ å”‰</p>
<h2 id="æŒ–æ´"><a href="#æŒ–æ´" class="headerlink" title="æŒ–æ´"></a>æŒ–æ´</h2><p>é¦–å…ˆæŒ–æ˜æœºè¯•SS,ä¸æ”¯æŒHttpä»£ç†. æ‰€ä»¥è¦å…ˆå®‰è£…<code>polipo</code>å°†socket5çš„è½¬æˆhttp</p>
<h3 id="å®‰è£…Polipo"><a href="#å®‰è£…Polipo" class="headerlink" title="å®‰è£…Polipo"></a>å®‰è£…Polipo</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>polipo</span><br></pre></td></tr></table></figure>
<h3 id="è®¾ç½®socket5è½¬http"><a href="#è®¾ç½®socket5è½¬http" class="headerlink" title="è®¾ç½®socket5è½¬http"></a>è®¾ç½®socket5è½¬http</h3><p>æŸ¥çœ‹è‡ªå·±SSçš„ç›‘å¬ç«¯å£</p>
<p><img src="/media/15358096727331.jpg" alt=""></p>
<p>ç„¶åå‘½ä»¤è¡Œæ‰§è¡Œ</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">polipo <span class="attribute">socksParentProxy</span>=localhost:1086</span><br></pre></td></tr></table></figure>
<p>æˆ‘çš„ç«¯å£æ˜¯<code>1086</code>,è¿™å—è¦æ¢æˆä½ è‡ªå·±çš„</p>
<p>è¿è¡ŒæˆåŠŸåå‡ºç°</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Established listening socket on<span class="built_in"> port </span>8123.</span><br></pre></td></tr></table></figure>
<h3 id="è®¾ç½®Sublimeçš„PackageControlä½¿ç”¨ä»£ç†"><a href="#è®¾ç½®Sublimeçš„PackageControlä½¿ç”¨ä»£ç†" class="headerlink" title="è®¾ç½®Sublimeçš„PackageControlä½¿ç”¨ä»£ç†"></a>è®¾ç½®Sublimeçš„PackageControlä½¿ç”¨ä»£ç†</h3><p><img src="/media/15358098449757.jpg" alt=""></p>
<p>æŒ‰å›¾è¿›å…¥<code>Sublime</code> PackageControlçš„ <code>Settings-Users</code></p>
<p>æ·»åŠ </p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"http_proxy"</span>: <span class="string">"http://127.0.0.1:8123"</span>,</span><br><span class="line"><span class="string">"https_proxy"</span>: <span class="string">"http://127.0.0.1:8123"</span>,</span><br></pre></td></tr></table></figure>
<p>å¦‚å›¾<br><img src="/media/15358099198000.jpg" alt=""></p>
<p>æ© ç„¶åä¸€åˆ‡å°±å¤§åŠŸå‘Šæˆäº†.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/b85b98c0-9801-11e8-8ddf-cf091e5f791e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="éš”å£è€ç‹">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="éš”å£è€ç‹">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/b85b98c0-9801-11e8-8ddf-cf091e5f791e/" itemprop="url">å¦‚ä½•æ­£ç¡®çš„ä½¿ç”¨Unityçš„Sprite Atlas</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-08-05T00:16:19+08:00">
                2018-08-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Unity/" itemprop="url" rel="index">
                    <span itemprop="name">Unity</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>åšäº†å‡ ä¸ªå…³äºspriteatlasçš„å®éªŒ,æ”¶è·ä¸å°‘. è¿‡ç¨‹æ‡’å¾—å†™äº†.å°±æŠŠæœ€åå…³é”®çš„ä¸¤ç‚¹åˆ—ä¸€ä¸‹å§.</p>
<h2 id="æ˜¾å­˜"><a href="#æ˜¾å­˜" class="headerlink" title="æ˜¾å­˜"></a>æ˜¾å­˜</h2><p>å½“imgè¢«æ”¾å…¥çº¹ç†é›†ä»¥å,æ— è®ºåŸimgæ˜¯å¦åœ¨<code>Resources</code>ç›®å½•.æ˜¾å­˜ä¸­å‡ä½¿ç”¨çš„æ˜¯çº¹ç†é›†è€ŒéåŸå§‹å›¾ç‰‡.</p>
<p>æ¯”å¦‚æ¸¸æˆä¸­æœ‰10ä¸ªç‰©å“,èƒŒåŒ…å±•ç¤ºæ—¶å€™ ä½ é€šè¿‡<code>Resource.Load&lt;Sprite&gt;($imgPath)</code>åŠ è½½å¯¹åº”çš„å›¾ç‰‡è¿›è¡Œå±•ç¤º. ä½†æ˜¯è¯¥å›¾ç‰‡å·²ç»è¢«æ‰“å…¥çº¹ç†é›†äº†. åˆ™æ­¤æ—¶æ˜¾å­˜ä¸­åŠ è½½çš„æ˜¯çº¹ç†é›†è€Œéå•å¼ å›¾ç‰‡ç´ æ</p>
<p><img src="/media/Jietu20180804-235830.jpg" alt="Jietu20180804-235830"></p>
<p>å¦‚å›¾,è£¸åŒ…19ä¸ªçº¹ç† æ‰“æˆçº¹ç†é›†å æ— è®ºå¦‚ä½•æŠ˜è…¾éƒ½æ˜¯20ä¸ªçº¹ç†.</p>
<h2 id="APKåŒ…ä½“"><a href="#APKåŒ…ä½“" class="headerlink" title="APKåŒ…ä½“"></a>APKåŒ…ä½“</h2><p>åŸå§‹å›¾ç‰‡å¦‚æœæ”¾å…¥<code>Resources</code>ç›®å½•åˆ™ä¼šè¢«å…¨é‡æ‰“å…¥APK(å³ä½¿æ ¹æœ¬ç”¨ä¸åˆ°â˜¹ï¸). ä½†æ˜¯å¦‚æœæ”¾åœ¨å¤–éƒ¨,åªæœ‰çº¹ç†é›†æ”¾å…¥<code>Resources</code>ç›®å½•åˆ™åŸç´ æåªä¼šæ‰“å…¥å¾ˆå°ä¸€éƒ¨åˆ†ä¿¡æ¯.</p>
<p><img src="/media/Jietu20180805-001221.jpg" alt="Jietu20180805-001221"></p>
<p><img src="/media/Jietu20180805-001021.jpg" alt="Jietu20180805-001021"></p>
<p>æ© è¿™ä¸ªæ˜¯æ¯”è¾ƒå°´å°¬çš„åœ°æ–¹äº†. </p>
<p>å¦‚æœæ‰€æœ‰å›¾ç‰‡éƒ½æ˜¯è¢«é—´æ¥å¼•ç”¨çš„. æ¯”å¦‚ä¸€ä¸ªPrefabé‡Œé¢æœ‰ä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†ä¸€ä¸ªSpreiteRenderç„¶åå¼•ç”¨äº†Pic1.jpg.</p>
<p>è¿™æ—¶å€™åªè¦æŠŠImgå’Œçº¹ç†é›†éƒ½ä¸¢åˆ°<code>Resource</code>ç›®å½•å¤–é¢å³å¯. æ‰“å‡ºåŒ…æ¥ ç»“æ„ä¹Ÿä¼šå’Œæ–¹æ¡ˆ2ä¸€æ ·çš„.</p>
<p>ä½†æ˜¯ å¦‚æœé¡¹ç›®ä¸­å­˜åœ¨ éœ€è¦ç”¨è·¯å¾„å»è¿›è¡Œ<code>Resource.Lord&lt;Sprite&gt;($imgPath)</code>æ¥è®¿é—®èµ„æºæ—¶å€™. åŸå§‹èµ„æºå¦‚æœä¸åœ¨<code>Resource</code>ç›®å½•å°±æ ¹æœ¬è®¿é—®ä¸åˆ°.</p>
<p>æ­¤æ—¶éœ€è¦é¦–å…ˆLoadåˆ°çº¹ç†é›†,ç„¶åé€šè¿‡<code>GetSprites</code>æ–¹æ³•è®¿é—®åˆ°ç›¸åº”çº¹ç†. ä¹Ÿå°±æ˜¯è‡ªå·±éœ€è¦ç»´æŠ¤ä¸€ä»½çº¹ç†é›†å’Œå›¾ç‰‡çš„ä»å±å…³ç³».ç„¶åå°è£…ä¸€ä¸‹Loadå‡½æ•°æ‰è¡Œ.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/02be5110-96ee-11e8-b96a-33aa607b4d67/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="éš”å£è€ç‹">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="éš”å£è€ç‹">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/02be5110-96ee-11e8-b96a-33aa607b4d67/" itemprop="url">å‡ºç° XXX can only be called on an active agent that has been placed on a NavMesh çš„åŸå› åŠè§£å†³æ–¹æ³•</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-08-03T15:22:42+08:00">
                2018-08-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Unity/" itemprop="url" rel="index">
                    <span itemprop="name">Unity</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="é”™è¯¯"><a href="#é”™è¯¯" class="headerlink" title="é”™è¯¯"></a>é”™è¯¯</h2><blockquote>
<p>â€œIsStoppedâ€ can only be called on an active agent that has been placed on a NavMesh.</p>
</blockquote>
<hr>
<blockquote>
<p>â€œGetRemainingDistanceâ€ can only be called on an active agent that has been placed on a NavMesh.</p>
</blockquote>
<p>æˆ–è€…å…¶ä»–ç±»ä¼¼çš„,ç”±äºæ²¡æœ‰æŠŠNavMeshAgentæ”¾ç½®åœ¨NavMeshæ‰€å¯¼è‡´çš„é”™è¯¯</p>
<h2 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h2><p>å¤§éƒ¨åˆ†åŸå› æ˜¯ä¸¤ç§</p>
<ul>
<li>åˆå§‹åŒ–æ—¶å€™æ”¾ç½®çš„NavMeshAgentçš„Positionæ¯”NavMeshè¦ä½.</li>
</ul>
<p>æ¯”å¦‚åƒæˆ‘è‡ªå·±çš„é¡¹ç›®,å°±å‡ºç°è¿™ç§æƒ…å†µ. æˆ‘çš„NavMeshæœ€å<code>Bake</code>å®Œæ‰€åœ¨çš„å¹³é¢æ˜¯(0,0.2f,0) ä¹Ÿå°±æ˜¯ <code>y = 0.2f</code> çš„å¹³é¢. ä½†æ˜¯æˆ‘åˆ›å»ºNavMeshAgentæ—¶å€™,å…¶åœ¨Prefabä¸­é»˜è®¤çš„åæ ‡æ˜¯(0,0,0)</p>
<ul>
<li>Agentä¹‹å‰åœ¨NavMeshä¸Šé¢.ä½†æ˜¯åé¢é€šè¿‡è®¾ç½®<code>transfrom.position</code>å¯¼è‡´å…¶åç¦»çš„NavMesh.</li>
</ul>
<p>ä»¥ä¸Šä¸¤ç§æƒ…å†µéƒ½ä¼šå‡ºç° å¦‚ä¸‹çš„é”™è¯¯ä¿¡æ¯</p>
<blockquote>
<p>XXX can only be called on an active agent that has been placed on a NavMesh</p>
</blockquote>
<h2 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h2><ul>
<li>åˆå§‹åŒ–æ—¶å€™å°±è®¾ç½®Positionåç§»</li>
</ul>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Prefab ;</span><br><span class="line"><span class="keyword">var</span> offsetV3 = <span class="keyword">new</span> <span class="type">Vector</span>(<span class="number">0</span>,<span class="number">0.21</span>f,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> <span class="keyword">new</span><span class="type">Go</span> = GameObject.Instantiate(Prefab, offsetV3, Quaternion.identity);</span><br></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨Wrapå‡½æ•°</li>
</ul>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Prefab;</span><br><span class="line"><span class="keyword">var</span> offsetV3 = <span class="keyword">new</span> <span class="type">Vector</span>(<span class="number">0</span>,<span class="number">0.21</span>f,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> <span class="keyword">new</span><span class="type">Go</span> = GameObject.Instantiate(Prefab);</span><br><span class="line"><span class="keyword">var</span> agent = <span class="keyword">new</span><span class="type">Go</span>.GetComponent&lt;NavMeshAgent&gt;();</span><br><span class="line">agent.Wrap(offsetV3);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/3dbcea40-93fd-11e8-82b5-5f6e29863172/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="éš”å£è€ç‹">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="éš”å£è€ç‹">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/3dbcea40-93fd-11e8-82b5-5f6e29863172/" itemprop="url">Unity UGUI Image å–„ç”¨çº¹ç†çš„WrapMode</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-07-30T21:34:10+08:00">
                2018-07-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Unity/" itemprop="url" rel="index">
                    <span itemprop="name">Unity</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p><img src="/media/Jietu20180730-213540.jpg" alt="Jietu20180730-213540"></p>
<p>åšä¹‹å‰ç®­å¤´æ¼”ç¤ºDemoæ—¶å€™,ç›´æ¥TiledæŠ»æ‹‰äº†ç®­å¤´Bodyéƒ¨åˆ†. åº•ä¸‹æœ‰ä¸€æ®µWarningæç¤º,ä¹‹å‰ä¸€ç›´æ²¡æ³¨æ„.ä»Šå¤©æ— æ„é—´çœ‹åˆ°äº†.</p>
<blockquote>
<p>It looks like you want to tile a sprite with no border. It would be more efficient to â€¦</p>
</blockquote>
<h2 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h2><p>å…¶å®è¿™ä¸ªè¯´çš„æ˜¯ä½¿ç”¨çº¹ç†çš„WrapModeè®¾ç½®é”™äº†. è™½ç„¶å¯ä»¥åšåˆ°Tiled.ä½†æ˜¯æ•ˆç‡ä¸é«˜.</p>
<p>åˆ‡æ¢åˆ°<code>Wireframe</code>ä¸‹çœ‹çš„ä¸€ç›®äº†ç„¶.</p>
<p><img src="/media/Jietu20180730-214355.jpg" alt="Jietu20180730-214355"></p>
<p>å¯ä»¥çœ‹åˆ° <code>Clamp</code>æ˜¯é€šè¿‡ç»˜åˆ¶äº†å¤šä¸ªâ€æ–¹å—â€æ‰è¾¾åˆ°çš„Tiled,è€Œ<code>Repeat</code>åªç»˜åˆ¶äº†ä¸€ä¸ªâ€æ–¹å—â€. ä¸“ä¸šä¸€ç‚¹çš„è¯´æ³•å°±æ˜¯åè€… ä½¿ç”¨çš„é¡¶ç‚¹(vertices)æ¯”å‰è€…å°‘. æ‰€ä»¥æ€§èƒ½ä¼šé«˜ ğŸ˜€</p>
<h2 id="å¼•ç”³é˜…è¯»"><a href="#å¼•ç”³é˜…è¯»" class="headerlink" title="å¼•ç”³é˜…è¯»"></a>å¼•ç”³é˜…è¯»</h2><p><a href="https://blog.csdn.net/lzhq1982/article/details/75045358" target="_blank" rel="noopener">Unity Shaderå…¥é—¨ç²¾è¦ç¬”è®°ï¼ˆåäºŒï¼‰ï¼šçº¹ç†å±æ€§</a><br>é‡Œé¢æœ‰è¯¦ç»†çš„ä»‹ç» <code>Clamp</code>å’Œ<code>Repeat</code>çš„åŒºåˆ«</p>
<p><code>Repeat</code><br><img src="/media/20170712210355009.jpg" alt="20170712210355009"></p>
<p><code>Clamp</code><br><img src="/media/20170712210408517.jpg" alt="20170712210408517"></p>
<p>æ³¨æ„ Clamp æ˜¯å¯¹çº¹ç†å¤–å›´1åƒç´ è¿›è¡Œæ— é™æŠ»æ‹‰. è¯¦æƒ…ä¹Ÿå¯å‚ç…§ <a href="https://docs.unity3d.com/ScriptReference/TextureWrapMode.Clamp.html" target="_blank" rel="noopener">å®˜ç½‘API TextureWrapMode.Clamp</a></p>
<blockquote>
<p>Clamps the texture to the last pixel at the edge.</p>
<p>This is useful for preventing wrapping artifacts when mapping an image onto an object and you donâ€™t want the texture to tile. UV coordinates will be clamped to the range 0â€¦1. When UVs are larger than 1 or smaller than 0, the last pixel at the border will be used.</p>
<p>This mode is called â€œclamp to edgeâ€ in graphics APIs like Vulkan, Metal and OpenGL.</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">éš”å£è€ç‹</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">37</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">éš”å£è€ç‹</span>

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>è®¿é—®äººæ•°
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>æ€»è®¿é—®é‡
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      æ¬¡
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  






  
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine@1.1.4/dist/Valine.min.js"></script>
  <script type="text/javascript">
    new Valine({
        av: AV,
        el: '#vcomments' ,
        verify: false,
        notify: false,
        app_id: 'VgjGdP2hIi00FTVlhhkQYpOx-gzGzoHsz',
        app_key: 'f6jqD57DmTmu5lR3DdobF3py',
        placeholder: 'è¯´ç‚¹å•¥?'
    });
  </script>



  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  

</body>
</html>
